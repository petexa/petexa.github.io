<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Utilities | Iron & Ale</title>
  <link rel="stylesheet" href="assets/css/style.css">
  <link href="https://fonts.googleapis.com/css?family=Orbitron:700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-WW47GEZS2M"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-WW47GEZS2M');
  </script>
</head>
<body class="neon-bg">
  <nav class="neon-nav" role="navigation" aria-label="Main navigation">
    <button class="menu-toggle" aria-label="Toggle navigation menu" aria-expanded="false">
      <span></span>
      <span></span>
      <span></span>
    </button>
    <ul id="nav-list">
      <li><a href="index.html" aria-label="Home page">Home</a></li>
      <li><a href="events.html" aria-label="View upcoming events">Events</a></li>
      <li><a href="utilities.html" class="active" aria-label="Site utilities" aria-current="page">Utilities</a></li>
    </ul>
  </nav>
  <main class="neon-main" role="main">
    <h1 class="neon-title">Utilities</h1>
    <section class="timer-section">
      <div class="event-card" style="max-width:400px;margin:0 auto;">
        <div class="event-content" style="align-items:center;">
          <h2 class="event-title" style="margin-bottom:18px;text-align:center;">CrossFit Timer</h2>
          <div class="timer-mode-select" style="display:flex;flex-direction:column;gap:18px;margin:24px 0;">
            <button class="timer-mode-btn" onclick="selectTimerMode('clock')" aria-label="Select Clock mode">CLOCK</button>
            <button class="timer-mode-btn" onclick="selectTimerMode('tabata')" aria-label="Select Tabata mode">TABATA</button>
            <button class="timer-mode-btn" onclick="selectTimerMode('fortime')" aria-label="Select For Time mode">FOR TIME</button>
            <button class="timer-mode-btn" onclick="selectTimerMode('emom')" aria-label="Select EMOM mode">EMOM</button>
            <button class="timer-mode-btn" onclick="selectTimerMode('amrap')" aria-label="Select AMRAP mode">AMRAP</button>
          </div>
          <div id="timer-mode-ui"></div>
        </div>
        </div>
        <div class="event-card" style="max-width:400px;margin:32px auto 0 auto;">
          <div class="event-content" style="align-items:center;">
            <h2 class="event-title" style="margin-bottom:18px;text-align:center;">One Rep Max Calculator (KG)</h2>
            <form id="orm-form" style="display:flex;flex-direction:column;gap:16px;align-items:center;">
              <div style="display:flex;gap:12px;align-items:center;">
                <label for="orm-weight" style="color:#19baff;font-family:'Orbitron',Arial,sans-serif;">Weight (kg):</label>
                <input type="number" id="orm-weight" min="1" max="500" value="60" style="width:80px;padding:6px 8px;border-radius:6px;border:1px solid #19baff;background:#222;color:#fff;" aria-label="Weight in kilograms" />
              </div>
              <div style="display:flex;flex-direction:column;align-items:center;width:100%;">
                <div style="display:flex;gap:8px;margin-bottom:8px;">
                  <button type="button" class="neon-btn neon-btn-blue" onclick="setORMReps(1)" aria-label="Set reps to 1">1</button>
                  <button type="button" class="neon-btn neon-btn-blue" onclick="setORMReps(3)" aria-label="Set reps to 3">3</button>
                  <button type="button" class="neon-btn neon-btn-blue" onclick="setORMReps(5)" aria-label="Set reps to 5">5</button>
                  <button type="button" class="neon-btn neon-btn-yellow" onclick="setORMReps(8)" aria-label="Set reps to 8">8</button>
                  <button type="button" class="neon-btn neon-btn-yellow" onclick="setORMReps(10)" aria-label="Set reps to 10">10</button>
                </div>
                <div style="display:flex;gap:12px;align-items:center;">
                  <label for="orm-reps" style="color:#ffb84d;font-family:'Orbitron',Arial,sans-serif;">Reps:</label>
                  <input type="number" id="orm-reps" min="1" max="20" value="5" style="width:60px;padding:6px 8px;border-radius:6px;border:1px solid #ffb84d;background:#222;color:#fff;" aria-label="Number of repetitions" />
                </div>
              </div>
              <div style="display:flex;gap:12px;align-items:center;">
                <label for="orm-formula" style="color:#39ff14;font-family:'Orbitron',Arial,sans-serif;">Formula:</label>
                <select id="orm-formula" style="padding:6px 8px;border-radius:6px;border:1px solid #39ff14;background:#222;color:#fff;" aria-label="Select calculation formula">
                  <option value="epley">Epley</option>
                  <option value="all">All</option>
                  <option value="brzycki">Brzycki</option>
                  <option value="lombardi">Lombardi</option>
                  <option value="oconner">O'Conner</option>
                </select>
              </div>
              <button type="button" class="neon-btn neon-btn-blue" onclick="calculateORM()" aria-label="Calculate one rep max">Calculate 1RM</button>
            </form>
            <div id="orm-result" style="margin-top:18px;font-size:1.2rem;color:#39ff14;text-align:center;font-family:'Orbitron',Arial,sans-serif;" role="status" aria-live="polite"></div>
          </div>
        </div>
        
        <!-- Workout Tracker Tile -->
        <div class="event-card" style="max-width:600px;margin:32px auto 0 auto;">
          <div class="event-content" style="align-items:center;">
            <h2 class="event-title" style="margin-bottom:18px;text-align:center;">Workout Tracker</h2>
            
            <form id="workout-form" style="display:flex;flex-direction:column;gap:16px;width:100%;max-width:500px;">
              <div style="display:flex;flex-direction:column;gap:8px;">
                <label for="workout-exercise" style="color:#19baff;font-family:'Orbitron',Arial,sans-serif;">Exercise:</label>
                <select id="workout-exercise" style="padding:12px;border-radius:6px;border:2px solid #19baff;background:#222;color:#fff;font-size:1rem;font-family:'Orbitron',Arial,sans-serif;" aria-label="Select exercise">
                  <option value="">-- Select Exercise --</option>
                  <option value="bench-press">Bench Press</option>
                  <option value="squat">Squat</option>
                  <option value="deadlift">Deadlift</option>
                  <option value="overhead-press">Overhead Press</option>
                  <option value="barbell-row">Barbell Row</option>
                  <option value="pullups">Pull-ups/Chin-ups</option>
                  <option value="dips">Dips</option>
                  <option value="bicep-curl">Bicep Curl</option>
                  <option value="tricep-extension">Tricep Extension</option>
                  <option value="lunges">Lunges</option>
                </select>
              </div>
              
              <div style="display:flex;flex-direction:column;gap:8px;">
                <label for="workout-date" style="color:#19baff;font-family:'Orbitron',Arial,sans-serif;">Date:</label>
                <input type="date" id="workout-date" style="padding:12px;border-radius:6px;border:2px solid #19baff;background:#222;color:#fff;font-size:1rem;" aria-label="Workout date" />
              </div>
              
              <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
                <div style="display:flex;flex-direction:column;gap:8px;">
                  <label for="workout-sets" style="color:#ffb84d;font-family:'Orbitron',Arial,sans-serif;">Sets:</label>
                  <input type="number" id="workout-sets" min="1" max="20" value="3" style="padding:12px;border-radius:6px;border:2px solid #ffb84d;background:#222;color:#fff;font-size:1rem;" aria-label="Number of sets" />
                </div>
                <div style="display:flex;flex-direction:column;gap:8px;">
                  <label for="workout-reps" style="color:#ffb84d;font-family:'Orbitron',Arial,sans-serif;">Reps:</label>
                  <input type="number" id="workout-reps" min="1" max="50" value="10" style="padding:12px;border-radius:6px;border:2px solid #ffb84d;background:#222;color:#fff;font-size:1rem;" aria-label="Number of reps" />
                </div>
              </div>
              
              <div style="display:flex;flex-direction:column;gap:8px;">
                <div style="display:flex;justify-content:space-between;align-items:center;">
                  <label for="workout-weight" style="color:#39ff14;font-family:'Orbitron',Arial,sans-serif;">Weight:</label>
                  <div style="display:flex;gap:8px;">
                    <button type="button" id="unit-kg" class="neon-btn neon-btn-blue" onclick="setWeightUnit('kg')" style="padding:6px 12px;font-size:0.85rem;" aria-label="Set unit to kilograms" aria-pressed="true">KG</button>
                    <button type="button" id="unit-lb" class="neon-btn neon-btn-yellow" onclick="setWeightUnit('lb')" style="padding:6px 12px;font-size:0.85rem;opacity:0.5;" aria-label="Set unit to pounds" aria-pressed="false">LB</button>
                  </div>
                </div>
                <input type="number" id="workout-weight" min="0" max="1000" step="0.5" value="60" style="padding:12px;border-radius:6px;border:2px solid #39ff14;background:#222;color:#fff;font-size:1rem;" aria-label="Weight lifted" />
              </div>
              
              <div style="display:flex;flex-direction:column;gap:8px;">
                <label for="workout-notes" style="color:#fff;font-family:'Orbitron',Arial,sans-serif;">Notes (form cues, RPE, tempo):</label>
                <textarea id="workout-notes" rows="3" style="padding:12px;border-radius:6px;border:2px solid #fff;background:#222;color:#fff;font-size:1rem;font-family:Arial,sans-serif;resize:vertical;" placeholder="e.g., RPE 8, controlled tempo, good form" aria-label="Workout notes"></textarea>
              </div>
              
              <div style="display:flex;gap:12px;flex-wrap:wrap;justify-content:center;">
                <button type="button" class="neon-btn neon-btn-blue" onclick="saveWorkout()" aria-label="Save workout entry" style="flex:1;min-width:120px;">Save Entry</button>
                <button type="button" class="neon-btn neon-btn-yellow" onclick="exportWorkouts()" aria-label="Export workouts as CSV" style="flex:1;min-width:120px;">Export CSV</button>
              </div>
            </form>
            
            <div id="workout-pr-message" style="margin-top:16px;padding:12px;border-radius:8px;background:rgba(57,255,20,0.1);border:2px solid #39ff14;color:#39ff14;font-family:'Orbitron',Arial,sans-serif;text-align:center;display:none;" role="alert" aria-live="assertive">
              üèÜ NEW PERSONAL RECORD! üèÜ
            </div>
            
            <div style="margin-top:24px;width:100%;">
              <h3 style="color:#19baff;font-family:'Orbitron',Arial,sans-serif;text-align:center;margin-bottom:16px;">Progress Chart</h3>
              <div style="display:flex;flex-direction:column;gap:8px;margin-bottom:16px;">
                <label for="chart-exercise" style="color:#19baff;font-family:'Orbitron',Arial,sans-serif;">Select Exercise to View:</label>
                <select id="chart-exercise" onchange="updateChart()" style="padding:12px;border-radius:6px;border:2px solid #19baff;background:#222;color:#fff;font-size:1rem;font-family:'Orbitron',Arial,sans-serif;" aria-label="Select exercise for chart">
                  <option value="">-- Select Exercise --</option>
                  <option value="bench-press">Bench Press</option>
                  <option value="squat">Squat</option>
                  <option value="deadlift">Deadlift</option>
                  <option value="overhead-press">Overhead Press</option>
                  <option value="barbell-row">Barbell Row</option>
                  <option value="pullups">Pull-ups/Chin-ups</option>
                  <option value="dips">Dips</option>
                  <option value="bicep-curl">Bicep Curl</option>
                  <option value="tricep-extension">Tricep Extension</option>
                  <option value="lunges">Lunges</option>
                </select>
              </div>
              <canvas id="workout-chart" style="max-height:300px;"></canvas>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>
  <script>
    // Hamburger menu toggle for mobile
    const menuToggle = document.querySelector('.menu-toggle');
    const navList = document.getElementById('nav-list');
    menuToggle.addEventListener('click', function() {
      const expanded = menuToggle.getAttribute('aria-expanded') === 'true';
      menuToggle.setAttribute('aria-expanded', !expanded);
      navList.classList.toggle('show');
    });

    // One Rep Max Calculator (multiple formulas)
    function setORMReps(val) {
      document.getElementById('orm-reps').value = val;
    }

    // Timer duration quick select
    function setTimerDuration(minutes) {
      const input = document.getElementById('timer-duration');
      if (input) {
        input.value = minutes;
        timerSeconds = minutes * 60;
        updateTimerDisplay();
      }
    }

    // Fullscreen toggle
    function toggleFullscreen() {
      const timerDisplay = document.getElementById('timer-display') || document.getElementById('emom-timer');
      if (!timerDisplay) return;

      if (!document.fullscreenElement) {
        const container = timerDisplay.closest('.event-card');
        if (container && container.requestFullscreen) {
          container.requestFullscreen().catch(err => {
            console.log('Fullscreen request failed:', err);
          });
        }
      } else {
        if (document.exitFullscreen) {
          document.exitFullscreen();
        }
      }
    }

    function calculateORM() {
      const weight = parseFloat(document.getElementById('orm-weight').value);
      const reps = parseInt(document.getElementById('orm-reps').value);
      const formula = document.getElementById('orm-formula').value;
      if (isNaN(weight) || isNaN(reps) || weight <= 0 || reps <= 0) {
        document.getElementById('orm-result').textContent = 'Please enter valid values.';
        document.getElementById('orm-result').style.color = '#ff5555';
        return;
      }
      // Formulas
      const results = [];
      let oneRM = 0;
      if (formula === 'all' || formula === 'epley') {
        // Epley: 1RM = weight * (1 + reps/30)
        const epley = weight * (1 + reps / 30);
        results.push(`<span style='color:#19baff;'>Epley:</span> <b>${epley.toFixed(1)} kg</b>`);
        if (formula === 'epley') oneRM = epley;
      }
      if (formula === 'all' || formula === 'brzycki') {
        // Brzycki: 1RM = weight * (36 / (37 - reps))
        const brzycki = weight * (36 / (37 - reps));
        results.push(`<span style='color:#ffb84d;'>Brzycki:</span> <b>${brzycki.toFixed(1)} kg</b>`);
        if (formula === 'brzycki') oneRM = brzycki;
      }
      if (formula === 'all' || formula === 'lombardi') {
        // Lombardi: 1RM = weight * reps^0.10
        const lombardi = weight * Math.pow(reps, 0.10);
        results.push(`<span style='color:#39ff14;'>Lombardi:</span> <b>${lombardi.toFixed(1)} kg</b>`);
        if (formula === 'lombardi') oneRM = lombardi;
      }
      if (formula === 'all' || formula === 'oconner') {
        // O'Conner: 1RM = weight * (1 + 0.025 * reps)
        const oconner = weight * (1 + 0.025 * reps);
        results.push(`<span style='color:#ff5555;'>O'Conner:</span> <b>${oconner.toFixed(1)} kg</b>`);
        if (formula === 'oconner') oneRM = oconner;
      }
      
      // If "All" is selected, calculate average for percentages
      if (formula === 'all') {
        const epley = weight * (1 + reps / 30);
        const brzycki = weight * (36 / (37 - reps));
        const lombardi = weight * Math.pow(reps, 0.10);
        const oconner = weight * (1 + 0.025 * reps);
        oneRM = (epley + brzycki + lombardi + oconner) / 4;
      }
      
      // Add training percentages
      if (oneRM > 0) {
        results.push('<br><span style="color:#39ff14;font-size:1rem;">Training Percentages:</span>');
        const percentages = [95, 90, 85, 80, 75, 70, 65, 60];
        const percentList = percentages.map(p => 
          `<span style="color:#19baff;">${p}%:</span> ${(oneRM * p / 100).toFixed(1)} kg`
        ).join(' | ');
        results.push(`<div style="font-size:0.9rem;margin-top:8px;line-height:1.6;">${percentList}</div>`);
      }
      
      document.getElementById('orm-result').innerHTML = results.join('<br>');
      document.getElementById('orm-result').style.color = '#39ff14';
    }

    // CrossFit Timer functionality
    let timerInterval = null;
    let timerSeconds = 0;
    let timerMode = '';

    function selectTimerMode(mode) {
      timerMode = mode;
      clearInterval(timerInterval);
      timerSeconds = 0;
      
      const timerUI = document.getElementById('timer-mode-ui');
      
      if (mode === 'clock') {
        timerUI.innerHTML = `
          <div style="text-align:center;">
            <div style="position:relative;">
              <div style="font-size:3rem;color:#19baff;font-family:'Orbitron',Arial,sans-serif;text-shadow:0 0 16px #19baff;margin:24px 0;" id="timer-display">00:00</div>
              <button class="neon-btn neon-btn-blue" onclick="toggleFullscreen()" style="position:absolute;top:0;right:0;padding:8px 12px;font-size:0.8rem;" aria-label="Toggle fullscreen mode">‚õ∂</button>
            </div>
            <div style="display:flex;gap:12px;justify-content:center;flex-wrap:wrap;">
              <button class="neon-btn neon-btn-blue" onclick="startTimer()" aria-label="Start timer">Start</button>
              <button class="neon-btn neon-btn-yellow" onclick="pauseTimer()" aria-label="Pause timer">Pause</button>
              <button class="neon-btn neon-btn-blue" onclick="resetTimer()" aria-label="Reset timer">Reset</button>
            </div>
          </div>
        `;
      } else if (mode === 'emom') {
        timerUI.innerHTML = `
          <div style="text-align:center;">
            <label style="color:#19baff;">Minutes:</label>
            <div style="display:flex;gap:6px;justify-content:center;margin-bottom:8px;flex-wrap:wrap;">
              <button type="button" class="neon-btn neon-btn-blue orm-rep-btn" onclick="setEMOMMins(1)" aria-label="Set EMOM to 1 minute">1</button>
              <button type="button" class="neon-btn neon-btn-blue orm-rep-btn" onclick="setEMOMMins(2)" aria-label="Set EMOM to 2 minutes">2</button>
              <button type="button" class="neon-btn neon-btn-blue orm-rep-btn" onclick="setEMOMMins(3)" aria-label="Set EMOM to 3 minutes">3</button>
              <button type="button" class="neon-btn neon-btn-yellow orm-rep-btn" onclick="setEMOMMins(4)" aria-label="Set EMOM to 4 minutes">4</button>
              <button type="button" class="neon-btn neon-btn-yellow orm-rep-btn" onclick="setEMOMMins(5)" aria-label="Set EMOM to 5 minutes">5</button>
            </div>
            <input type="number" id="emom-mins" min="1" max="60" value="1" style="width:50px;" aria-label="EMOM minutes" />
            <br>
            <div style="position:relative;">
              <div id="emom-timer" style="font-size:3.5rem;color:#19baff;margin:24px 0;text-align:center;letter-spacing:0.1em;font-family:Orbitron,Arial,sans-serif;background:#111;padding:16px 0;border-radius:12px;box-shadow:0 0 24px #19baff;">01:00</div>
              <button class="neon-btn neon-btn-blue" onclick="toggleFullscreen()" style="position:absolute;top:0;right:0;padding:8px 12px;font-size:0.8rem;" aria-label="Toggle fullscreen mode">‚õ∂</button>
            </div>
            <div id="emom-round" style="margin-bottom:8px;color:#39ff14;" role="status" aria-live="polite">Round 1</div>
            <div style="display:flex;gap:12px;justify-content:center;flex-wrap:wrap;">
              <button class="neon-btn neon-btn-blue" onclick="startEMOMTimer()" aria-label="Start EMOM timer">Start</button>
              <button class="neon-btn neon-btn-yellow" onclick="pauseEMOMTimer()" aria-label="Pause EMOM timer">Pause</button>
              <button class="neon-btn neon-btn-blue" onclick="resetEMOMTimer()" aria-label="Reset EMOM timer">Reset</button>
            </div>
          </div>
        `;
        window.emomTimer = 60;
        window.emomInterval = null;
        window.emomPaused = false;
        window.emomRound = 1;
        window.emomTotalRounds = 10;
        updateEMOMDisplay();
      } else if (mode === 'fortime' || mode === 'amrap') {
        const label = mode === 'fortime' ? 'For Time' : 'AMRAP';
        timerUI.innerHTML = `
          <div style="text-align:center;">
            <div style="margin:16px 0;">
              <label style="color:#19baff;">Duration (minutes): </label>
              <div style="display:flex;gap:6px;justify-content:center;margin:8px 0;flex-wrap:wrap;">
                <button type="button" class="neon-btn neon-btn-blue orm-rep-btn" onclick="setTimerDuration(1)" aria-label="Set timer to 1 minute">1</button>
                <button type="button" class="neon-btn neon-btn-blue orm-rep-btn" onclick="setTimerDuration(2)" aria-label="Set timer to 2 minutes">2</button>
                <button type="button" class="neon-btn neon-btn-blue orm-rep-btn" onclick="setTimerDuration(3)" aria-label="Set timer to 3 minutes">3</button>
                <button type="button" class="neon-btn neon-btn-yellow orm-rep-btn" onclick="setTimerDuration(4)" aria-label="Set timer to 4 minutes">4</button>
                <button type="button" class="neon-btn neon-btn-yellow orm-rep-btn" onclick="setTimerDuration(5)" aria-label="Set timer to 5 minutes">5</button>
              </div>
              <input type="number" id="timer-duration" value="20" min="1" max="180" style="width:60px;padding:4px;border-radius:4px;border:1px solid #19baff;background:#222;color:#fff;" aria-label="Timer duration in minutes">
            </div>
            <div style="position:relative;">
              <div style="font-size:3rem;color:#19baff;font-family:'Orbitron',Arial,sans-serif;text-shadow:0 0 16px #19baff;margin:24px 0;" id="timer-display">20:00</div>
              <button class="neon-btn neon-btn-blue" onclick="toggleFullscreen()" style="position:absolute;top:0;right:0;padding:8px 12px;font-size:0.8rem;" aria-label="Toggle fullscreen mode">‚õ∂</button>
            </div>
            <div style="display:flex;gap:12px;justify-content:center;flex-wrap:wrap;">
              <button class="neon-btn neon-btn-blue" onclick="startCountdown()" aria-label="Start timer">Start</button>
              <button class="neon-btn neon-btn-yellow" onclick="pauseTimer()" aria-label="Pause timer">Pause</button>
              <button class="neon-btn neon-btn-blue" onclick="resetTimer()" aria-label="Reset timer">Reset</button>
            </div>
          </div>
        `;
        timerSeconds = 20 * 60;
        updateTimerDisplay();
      } else if (mode === 'tabata') {
        timerUI.innerHTML = `
          <div style="text-align:center;">
            <div style="margin:16px 0;display:flex;flex-direction:column;gap:12px;align-items:center;">
              <div style="display:flex;gap:12px;align-items:center;">
                <label style="color:#19baff;">Work:</label>
                <input type="number" id="tabata-work" value="20" min="1" max="180" style="width:60px;padding:4px;border-radius:4px;border:1px solid #19baff;background:#222;color:#fff;" aria-label="Work duration in seconds">
              </div>
              <div style="display:flex;gap:12px;align-items:center;">
                <label style="color:#ffb84d;">Rest:</label>
                <input type="number" id="tabata-rest" value="10" min="1" max="180" style="width:60px;padding:4px;border-radius:4px;border:1px solid #ffb84d;background:#222;color:#fff;" aria-label="Rest duration in seconds">
              </div>
              <div style="display:flex;gap:12px;align-items:center;">
                <label style="color:#39ff14;">Rounds:</label>
                <input type="number" id="tabata-rounds" value="8" min="1" max="50" style="width:60px;padding:4px;border-radius:4px;border:1px solid #39ff14;background:#222;color:#fff;" aria-label="Number of rounds">
              </div>
            </div>
            <div style="position:relative;">
              <div style="font-size:3rem;color:#19baff;font-family:'Orbitron',Arial,sans-serif;text-shadow:0 0 16px #19baff;margin:24px 0;" id="timer-display">20</div>
              <button class="neon-btn neon-btn-blue" onclick="toggleFullscreen()" style="position:absolute;top:0;right:0;padding:8px 12px;font-size:0.8rem;" aria-label="Toggle fullscreen mode">‚õ∂</button>
            </div>
            <div style="display:flex;gap:12px;justify-content:center;flex-wrap:wrap;">
              <button class="neon-btn neon-btn-blue" onclick="startTabata()" aria-label="Start Tabata timer">Start</button>
              <button class="neon-btn neon-btn-yellow" onclick="pauseTimer()" aria-label="Pause Tabata timer">Pause</button>
              <button class="neon-btn neon-btn-blue" onclick="resetTimer()" aria-label="Reset Tabata timer">Reset</button>
            </div>
          </div>
        `;
        timerSeconds = 20;
        updateTimerDisplay();
      }
    }

    function updateTimerDisplay() {
      const display = document.getElementById('timer-display');
      if (!display) return;
      
      const mins = Math.floor(Math.abs(timerSeconds) / 60);
      const secs = Math.abs(timerSeconds) % 60;
      const sign = timerSeconds < 0 ? '-' : '';
      display.textContent = `${sign}${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
    }

    function startTimer() {
      clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        timerSeconds++;
        updateTimerDisplay();
      }, 1000);
    }

    function startCountdown() {
      const durationInput = document.getElementById('timer-duration');
      if (durationInput && timerSeconds === parseInt(durationInput.value) * 60) {
        // Reset if at starting position
        timerSeconds = parseInt(durationInput.value) * 60;
      }
      clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        timerSeconds--;
        updateTimerDisplay();
        if (timerSeconds <= 0) {
          clearInterval(timerInterval);
          document.getElementById('timer-display').style.color = '#39ff14';
        }
      }, 1000);
    }

    function pauseTimer() {
      clearInterval(timerInterval);
    }

    function resetTimer() {
      clearInterval(timerInterval);
      timerSeconds = 0;
      if (timerMode === 'fortime' || timerMode === 'amrap') {
        const duration = parseInt(document.getElementById('timer-duration').value) || 20;
        timerSeconds = duration * 60;
      }
      if (timerMode === 'emom') {
        document.getElementById('timer-display').textContent = 'Round 1 - 01:00';
        return;
      }
      updateTimerDisplay();
      if (document.getElementById('timer-display')) {
        document.getElementById('timer-display').style.color = '#19baff';
      }
    }

    function startTabata() {
      const work = parseInt(document.getElementById('tabata-work').value);
      const rest = parseInt(document.getElementById('tabata-rest').value);
      const rounds = parseInt(document.getElementById('tabata-rounds').value);
      
      let currentRound = 1;
      let isWork = true;
      timerSeconds = work;
      
      clearInterval(timerInterval);
      updateTimerDisplay();
      
      timerInterval = setInterval(() => {
        timerSeconds--;
        
        if (timerSeconds <= 0) {
          if (isWork) {
            // Switch to rest
            isWork = false;
            timerSeconds = rest;
            document.getElementById('timer-display').style.color = '#ffb84d';
          } else {
            // Move to next round
            currentRound++;
            if (currentRound > rounds) {
              clearInterval(timerInterval);
              document.getElementById('timer-display').textContent = 'DONE!';
              document.getElementById('timer-display').style.color = '#39ff14';
              return;
            }
            isWork = true;
            timerSeconds = work;
            document.getElementById('timer-display').style.color = '#19baff';
          }
        }
        updateTimerDisplay();
      }, 1000);
    }

    function startEMOM() {
      const rounds = parseInt(document.getElementById('emom-rounds').value);
      let currentRound = 1;
      timerSeconds = 60;
      
      clearInterval(timerInterval);
      document.getElementById('timer-display').textContent = `Round ${currentRound} - 01:00`;
      
      timerInterval = setInterval(() => {
        timerSeconds--;
        
        if (timerSeconds <= 0) {
          currentRound++;
          if (currentRound > rounds) {
            clearInterval(timerInterval);
            document.getElementById('timer-display').textContent = 'DONE!';
            document.getElementById('timer-display').style.color = '#39ff14';
            return;
          }
          timerSeconds = 60;
        }
        
        const mins = Math.floor(timerSeconds / 60);
        const secs = timerSeconds % 60;
        document.getElementById('timer-display').textContent = `Round ${currentRound} - ${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
      }, 1000);
    }

    // EMOM Timer Functions
    function setEMOMMins(val) {
      const input = document.getElementById('emom-mins');
      if (input) {
        input.value = val;
        window.emomTimer = val * 60;
        window.emomTotalRounds = val;
        updateEMOMDisplay();
      }
    }

    function updateEMOMDisplay() {
      const display = document.getElementById('emom-timer');
      const roundDisplay = document.getElementById('emom-round');
      if (display) {
        const mins = Math.floor(window.emomTimer / 60);
        const secs = window.emomTimer % 60;
        display.textContent = `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
      }
      if (roundDisplay) {
        roundDisplay.textContent = `Round ${window.emomRound}`;
      }
    }

    function startEMOMTimer() {
      if (window.emomInterval) return; // Already running
      
      window.emomPaused = false;
      const totalMinutes = parseInt(document.getElementById('emom-mins').value) || 1;
      window.emomTotalRounds = totalMinutes;
      
      window.emomInterval = setInterval(() => {
        if (!window.emomPaused) {
          window.emomTimer--;
          updateEMOMDisplay();
          
          if (window.emomTimer <= 0) {
            // Round complete
            if (window.emomRound >= window.emomTotalRounds) {
              // Workout complete
              clearInterval(window.emomInterval);
              window.emomInterval = null;
              document.getElementById('emom-timer').textContent = 'DONE!';
              document.getElementById('emom-timer').style.color = '#39ff14';
              // Play completion sound
              try {
                const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIF2i78OShUBEMUKvl8LdjHAU7k9n0zn4vBSh+zPLaizsKGGS56+ynVRQKRp/g8r5sIQUrgs7y2Ik2CBdou/DkoVARC1Cr5fC3YxwFO5PZ9M5+LwUofszy2os7ChhluevrqFYVC0af4PK+bCEFLIHO8tiJNggXaLvw5KFQEQtQq+Xwt2McBTuT2fTOfi8FKH7M8tqLOwoYZbnr66hWFQtGn+DyvmwhBSyBzvLYiTYIF2i78OShUBELUKvl8LdjHAU7k9n0zn4vBSh+zPLaizsKGGW56+uoVhULRp/g8r5sIQUsgs7y2Ik2CBdou/DkoVARC1Cr5fC3YxwFO5PZ9M5+LwUofszy2os7ChhluevrqFYVC0af4PK+bCEFLILO8tiJNggXaLvw5KFQEQtQq+Xwt2McBTuT2fTOfi8FKH7M8tqLOwoYZbnr66hWFQtGn+DyvmwhBSyCzvLYiTYIF2i78OShUBELUKvl8LdjHAU7k9n0zn4vBSh+zPLaizsKGGW56+uoVhULRp/g8r5sIQUsgs7y2Ik2CBdou/DkoVARC1Cr5fC3YxwFO5PZ9M5+LwUofszy2os7ChhluevrqFYVC0af4PK+bCEFLILO8tiJNggXaLvw5KFQEQtQq+Xwt2McBTuT2fTOfi8FKH7M8tqLOwoYZbnr66hWFQtGn+DyvmwhBSyCzvLYiTYIF2i78OShUBELUKvl8LdjHAU7k9n0zn4vBSh+zPLaizsKGGW56+uoVhULRp/g8r5sIQUsgs7y2Ik2CBdou/DkoVARC1Cr5fC3YxwFO5PZ9M5+LwUofszy2os7ChhluevrqFYVC0af4PK+bCEFLILO8tiJNggXaLvw5KFQEQtQq+Xwt2McBTuT2fTOfi8FKH7M8tqLOwoYZbnr66hWFQ==');
                audio.play();
              } catch (e) {
                console.log('Audio play failed:', e);
              }
              return;
            }
            // Next round
            window.emomRound++;
            window.emomTimer = 60;
            updateEMOMDisplay();
          }
        }
      }, 1000);
    }

    function pauseEMOMTimer() {
      window.emomPaused = !window.emomPaused;
    }

    function resetEMOMTimer() {
      clearInterval(window.emomInterval);
      window.emomInterval = null;
      window.emomPaused = false;
      window.emomRound = 1;
      const minutes = parseInt(document.getElementById('emom-mins').value) || 1;
      window.emomTimer = 60;
      window.emomTotalRounds = minutes;
      updateEMOMDisplay();
      const display = document.getElementById('emom-timer');
      if (display) {
        display.style.color = '#19baff';
      }
    }

    // Workout Tracker Functions
    let workoutUnit = 'kg';
    let workoutChart = null;

    // Initialize workout tracker
    function initWorkoutTracker() {
      // Set today's date
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('workout-date').value = today;
      
      // Initialize chart
      const ctx = document.getElementById('workout-chart');
      if (ctx) {
        workoutChart = new Chart(ctx, {
          type: 'line',
          data: {
            labels: [],
            datasets: [{
              label: 'Weight',
              data: [],
              borderColor: '#19baff',
              backgroundColor: 'rgba(25, 186, 255, 0.1)',
              borderWidth: 2,
              tension: 0.3,
              pointRadius: 6,
              pointHoverRadius: 8,
              pointBackgroundColor: '#19baff',
              pointBorderColor: '#fff',
              pointBorderWidth: 2
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
              legend: {
                display: true,
                labels: {
                  color: '#19baff',
                  font: {
                    family: 'Orbitron, Arial, sans-serif',
                    size: 14
                  }
                }
              },
              tooltip: {
                backgroundColor: 'rgba(10, 20, 40, 0.95)',
                titleColor: '#19baff',
                bodyColor: '#fff',
                borderColor: '#19baff',
                borderWidth: 1,
                titleFont: {
                  family: 'Orbitron, Arial, sans-serif'
                },
                bodyFont: {
                  family: 'Arial, sans-serif'
                }
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  color: '#19baff',
                  font: {
                    family: 'Orbitron, Arial, sans-serif'
                  }
                },
                grid: {
                  color: 'rgba(25, 186, 255, 0.1)'
                }
              },
              x: {
                ticks: {
                  color: '#19baff',
                  font: {
                    family: 'Orbitron, Arial, sans-serif'
                  }
                },
                grid: {
                  color: 'rgba(25, 186, 255, 0.1)'
                }
              }
            }
          }
        });
      }
    }

    function setWeightUnit(unit) {
      workoutUnit = unit;
      const kgBtn = document.getElementById('unit-kg');
      const lbBtn = document.getElementById('unit-lb');
      
      if (unit === 'kg') {
        kgBtn.style.opacity = '1';
        kgBtn.setAttribute('aria-pressed', 'true');
        lbBtn.style.opacity = '0.5';
        lbBtn.setAttribute('aria-pressed', 'false');
      } else {
        lbBtn.style.opacity = '1';
        lbBtn.setAttribute('aria-pressed', 'true');
        kgBtn.style.opacity = '0.5';
        kgBtn.setAttribute('aria-pressed', 'false');
      }
    }

    function saveWorkout() {
      const exercise = document.getElementById('workout-exercise').value;
      const date = document.getElementById('workout-date').value;
      const sets = parseInt(document.getElementById('workout-sets').value);
      const reps = parseInt(document.getElementById('workout-reps').value);
      const weight = parseFloat(document.getElementById('workout-weight').value);
      const notes = document.getElementById('workout-notes').value;

      if (!exercise || !date || !sets || !reps || weight < 0) {
        alert('Please fill in all required fields');
        return;
      }

      // Get existing workouts
      const workouts = JSON.parse(localStorage.getItem('ironAleWorkouts') || '[]');
      
      // Check for PR
      const exerciseWorkouts = workouts.filter(w => w.exercise === exercise);
      const isPR = exerciseWorkouts.length === 0 || 
                   exerciseWorkouts.every(w => w.weight < weight);

      // Create workout entry
      const workout = {
        id: Date.now(),
        exercise,
        date,
        sets,
        reps,
        weight,
        unit: workoutUnit,
        notes,
        isPR
      };

      // Save to localStorage
      workouts.push(workout);
      localStorage.setItem('ironAleWorkouts', JSON.stringify(workouts));

      // Show PR message if applicable
      if (isPR) {
        const prMessage = document.getElementById('workout-pr-message');
        prMessage.style.display = 'block';
        setTimeout(() => {
          prMessage.style.display = 'none';
        }, 5000);
      }

      // Show success message
      showToast('Workout saved successfully!');

      // Reset form
      document.getElementById('workout-sets').value = '3';
      document.getElementById('workout-reps').value = '10';
      document.getElementById('workout-weight').value = '60';
      document.getElementById('workout-notes').value = '';

      // Update chart if same exercise is selected
      if (document.getElementById('chart-exercise').value === exercise) {
        updateChart();
      }
    }

    function updateChart() {
      const exercise = document.getElementById('chart-exercise').value;
      if (!exercise || !workoutChart) return;

      const workouts = JSON.parse(localStorage.getItem('ironAleWorkouts') || '[]');
      const exerciseWorkouts = workouts
        .filter(w => w.exercise === exercise)
        .sort((a, b) => new Date(a.date) - new Date(b.date));

      if (exerciseWorkouts.length === 0) {
        workoutChart.data.labels = [];
        workoutChart.data.datasets[0].data = [];
        workoutChart.data.datasets[0].label = 'Weight';
        workoutChart.update();
        return;
      }

      const labels = exerciseWorkouts.map(w => {
        const date = new Date(w.date);
        return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
      });
      
      const data = exerciseWorkouts.map(w => w.weight);
      const unit = exerciseWorkouts[0]?.unit || 'kg';

      workoutChart.data.labels = labels;
      workoutChart.data.datasets[0].data = data;
      workoutChart.data.datasets[0].label = `Weight (${unit})`;
      
      // Highlight PRs
      workoutChart.data.datasets[0].pointBackgroundColor = exerciseWorkouts.map(w => 
        w.isPR ? '#39ff14' : '#19baff'
      );
      workoutChart.data.datasets[0].pointBorderColor = exerciseWorkouts.map(w => 
        w.isPR ? '#39ff14' : '#fff'
      );
      workoutChart.data.datasets[0].pointRadius = exerciseWorkouts.map(w => 
        w.isPR ? 8 : 6
      );

      workoutChart.update();
    }

    function exportWorkouts() {
      const workouts = JSON.parse(localStorage.getItem('ironAleWorkouts') || '[]');
      
      if (workouts.length === 0) {
        alert('No workouts to export');
        return;
      }

      // Create CSV content
      const headers = ['Date', 'Exercise', 'Sets', 'Reps', 'Weight', 'Unit', 'Notes', 'PR'];
      const rows = workouts.map(w => [
        w.date,
        w.exercise.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase()),
        w.sets,
        w.reps,
        w.weight,
        w.unit,
        w.notes ? `"${w.notes.replace(/"/g, '""')}"` : '',
        w.isPR ? 'YES' : 'NO'
      ]);

      const csv = [headers.join(','), ...rows.map(r => r.join(','))].join('\n');

      // Download CSV
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `iron-ale-workouts-${new Date().toISOString().split('T')[0]}.csv`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);

      showToast('Workouts exported successfully!');
    }

    function showToast(message) {
      const toast = document.createElement('div');
      toast.className = 'toast';
      toast.textContent = message;
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.classList.add('hide');
        setTimeout(() => {
          document.body.removeChild(toast);
        }, 300);
      }, 3000);
    }

    // Initialize workout tracker when page loads
    document.addEventListener('DOMContentLoaded', initWorkoutTracker);
  </script>
</body>
</html>
