<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Member Utilities | Iron & Ale</title>
  <meta name="description" content="Iron & Ale member utilities - Track your progress, access workout resources, and connect with community tools.">
  <link rel="stylesheet" href="assets/css/style.css">
  <link rel="icon" type="image/svg+xml" href="https://api.iconify.design/mdi:dumbbell.svg?color=%233b82f6" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-WW47GEZS2M"></script>
  <script>
                // Save workout to n8n webhook
                function saveWorkout() {
                  const submitMsg = document.getElementById('workout-submit-message');
                  if (submitMsg) {
                    submitMsg.style.display = 'none';
                    submitMsg.textContent = '';
                  }
                  const name = document.getElementById('workout-name')?.value.trim();
                  const exercise = document.getElementById('workout-exercise')?.value;
                  const date = document.getElementById('workout-date')?.value;
                  const sets = document.getElementById('workout-sets')?.value;
                  const reps = document.getElementById('workout-reps')?.value;
                  const weight = document.getElementById('workout-weight')?.value;
                  const time = document.getElementById('workout-time')?.value;
                  if (!name || !exercise || !date) {
                    if (submitMsg) {
                      submitMsg.textContent = 'Please fill in all required fields.';
                      submitMsg.style.display = 'block';
                      submitMsg.style.background = '#fee2e2';
                      submitMsg.style.color = '#b91c1c';
                    }
                    return;
                  }
                  const payload = {
                    name,
                    exercise,
                    date,
                    sets,
                    reps,
                    weight,
                    time
                  };
                  fetch('https://n8n.petefox.co.uk/webhook/workout-log', {
                    method: 'POST',
                    headers: {
                      'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                  })
                  .then(async response => {
                    if (!response.ok) {
                      let errorText = 'Failed to log workout.';
                      try {
                        const err = await response.text();
                        errorText += ' ' + err;
                      } catch {}
                      throw new Error(errorText);
                    }
                    return response.json().catch(() => ({}));
                  })
                  .then(data => {
                    if (submitMsg) {
                      submitMsg.textContent = 'Workout logged successfully!';
                      submitMsg.style.display = 'block';
                      submitMsg.style.background = '#d1fae5';
                      submitMsg.style.color = '#065f46';
                    }
                    document.getElementById('workout-form').reset();
                  })
                  .catch(error => {
                    if (submitMsg) {
                      submitMsg.textContent = error.message || 'Failed to log workout.';
                      submitMsg.style.display = 'block';
                      submitMsg.style.background = '#fee2e2';
                      submitMsg.style.color = '#b91c1c';
                    }
                  });
                }
        // Timer display update for clock, for time, amrap, tabata
        function updateTimerDisplay() {
          const display = document.getElementById('timer-display');
          if (!display) return;
          let mins = Math.floor(timerSeconds / 60);
          let secs = timerSeconds % 60;
          if (timerMode === 'tabata') {
            display.textContent = timerSeconds > 0 ? timerSeconds : 'DONE!';
          } else {
            display.textContent = `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
          }
        }

        function startTimer() {
          clearInterval(timerInterval);
          timerSeconds = timerSeconds || 0;
          updateTimerDisplay();
          timerInterval = setInterval(() => {
            timerSeconds++;
            updateTimerDisplay();
          }, 1000);
        }

        function pauseTimer() {
          clearInterval(timerInterval);
        }

        function resetTimer() {
          clearInterval(timerInterval);
          timerSeconds = 0;
          updateTimerDisplay();
        }

        function startCountdown() {
          clearInterval(timerInterval);
          updateTimerDisplay();
          timerInterval = setInterval(() => {
            timerSeconds--;
            updateTimerDisplay();
            if (timerSeconds <= 0) {
              clearInterval(timerInterval);
              document.getElementById('timer-display').textContent = 'DONE!';
            }
          }, 1000);
        }
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-WW47GEZS2M');
  </script>
</head>
<body class="bg-gray-900 text-white">
  <div class="page-wrapper">
    <nav class="bg-gray-800 shadow-lg" role="navigation" aria-label="Main navigation">
      <button class="menu-toggle" aria-label="Toggle navigation menu" aria-expanded="false">
        <span></span>
        <span></span>
        <span></span>
      </button>
      <ul id="nav-list">
        <li><a href="index.html" aria-label="Home page">HOME</a></li>
        <li><a href="events.html" aria-label="View upcoming events">EVENTS</a></li>
        <li><a href="projects.html" aria-label="View community projects">PROJECTS</a></li>
        <li><a href="utilities.html" class="active" aria-label="Member utilities" aria-current="page">UTILITIES</a></li>
      </ul>
    </nav>

    <main role="main">
      <section class="utilities-demo-section">
      <!-- Hero Banner -->
      <section class="hero-section" style="background-image: url('https://images.unsplash.com/photo-1517836357463-d25dfeac3438?w=1920&q=80'); min-height: 40vh;" aria-label="Utilities page header">
        <div class="hero-content">
          <h1 class="text-3xl font-bold text-blue-500">Member Utilities</h1>
          <p class="hero-headline">Tools to track, train, and connect</p>
        </div>
      </section>
      </section>

        <!-- Collapsible Utility Tools -->
        <div class="utility-collapsible-list">
          <!-- Plate Calculator -->
          <div class="utility-collapsible">
            <button class="utility-collapsible-header bg-gray-700 text-blue-400 hover:bg-blue-900 focus:bg-blue-900" onclick="toggleUtilitySection('plate-calc')" aria-expanded="false" aria-controls="plate-calc-content">
              <span class="section-icon mr-2" aria-hidden="true">üèãÔ∏è‚Äç‚ôÇÔ∏è</span> Plate Calculator (KG)
            </button>
            <div class="utility-collapsible-content" id="plate-calc-content" style="display:none;">
              <div class="utility-card" style="margin-top:0;">
                <h3 class="event-title" style="margin-bottom:18px;text-align:center;">Plate Calculator (KG)</h3>
                <div id="plate-calc-mode" class="flex justify-center gap-3 mb-3">
                  <button type="button" class="px-4 py-2 rounded bg-blue-500 text-white hover:bg-blue-700" id="mode-plates" onclick="setPlateCalcMode('plates')" aria-pressed="true">Calculate Plates Needed</button>
                  <button type="button" class="px-4 py-2 rounded bg-yellow-400 text-gray-900 hover:bg-yellow-500" id="mode-weight" onclick="setPlateCalcMode('weight')" aria-pressed="false">Calculate Total Weight</button>
                </div>
                <form id="plate-calculator-form" style="display:flex;flex-direction:column;gap:16px;width:100%;max-width:400px;margin:0 auto;">
                  <div style="display:flex;flex-direction:column;gap:8px;">
                    <label for="bar-weight" class="text-blue-400 font-semibold">Bar Weight (KG):</label>
                    <input type="number" id="bar-weight" min="10" max="30" value="20" class="p-3 rounded border-2 border-blue-400 bg-gray-800 text-white text-base" aria-label="Bar weight in KG" />
                  </div>
                  <div id="plates-mode-fields">
                    <div style="display:flex;flex-direction:column;gap:8px;">
                      <label for="target-weight" class="text-blue-400 font-semibold">Target Total Weight (KG):</label>
                      <input type="number" id="target-weight" min="20" max="300" value="60" class="p-3 rounded border-2 border-blue-400 bg-gray-800 text-white text-base" aria-label="Target total weight in KG" />
                    </div>
                    <button type="button" class="px-4 py-2 rounded bg-blue-500 text-white hover:bg-blue-700" onclick="calculatePlates()" aria-label="Calculate plate breakdown">Calculate Plates</button>
                  </div>
                  <div id="weight-mode-fields" style="display:none;">
                    <div style="display:flex;flex-direction:column;gap:8px;">
                      <label for="side-plates" class="text-blue-400 font-semibold">Plates on One Side (KG, comma separated):</label>
                      <input type="text" id="side-plates" placeholder="e.g. 20,10,2.5" class="p-3 rounded border-2 border-blue-400 bg-gray-800 text-white text-base" aria-label="Plates on one side in KG" />
                      <div class="flex gap-2 flex-wrap mt-2">
                        <button type="button" class="px-3 py-1 rounded bg-yellow-400 text-gray-900 hover:bg-yellow-500" onclick="addPlate(25)">+25kg</button>
                        <button type="button" class="px-3 py-1 rounded bg-yellow-400 text-gray-900 hover:bg-yellow-500" onclick="addPlate(20)">+20kg</button>
                        <button type="button" class="px-3 py-1 rounded bg-yellow-400 text-gray-900 hover:bg-yellow-500" onclick="addPlate(15)">+15kg</button>
                        <button type="button" class="px-3 py-1 rounded bg-yellow-400 text-gray-900 hover:bg-yellow-500" onclick="addPlate(10)">+10kg</button>
                        <button type="button" class="px-3 py-1 rounded bg-yellow-400 text-gray-900 hover:bg-yellow-500" onclick="addPlate(5)">+5kg</button>
                        <button type="button" class="px-3 py-1 rounded bg-yellow-400 text-gray-900 hover:bg-yellow-500" onclick="addPlate(2.5)">+2.5kg</button>
                        <button type="button" class="px-3 py-1 rounded bg-yellow-400 text-gray-900 hover:bg-yellow-500" onclick="addPlate(1.25)">+1.25kg</button>
                      </div>
                    </div>
                    <button type="button" class="px-4 py-2 rounded bg-blue-500 text-white hover:bg-blue-700" onclick="calculateWeight()" aria-label="Calculate total weight">Calculate Total Weight</button>
                  </div>
                </form>
                                <!-- Workout Log Table -->
                                <div id="workout-log-table" style="margin-top:32px;"></div>
                <div id="plate-result" class="mt-4 text-center text-white font-mono"></div>
              </div>
            </div>
          </div>
          <!-- Workout Tracker (moved above Progress Chart) -->
          <div class="utility-collapsible">
            <button class="utility-collapsible-header" onclick="toggleUtilitySection('workout-tracker')" aria-expanded="false" aria-controls="workout-tracker-content">
              <span class="section-icon" aria-hidden="true">üìù</span> Workout Tracker
            </button>
            <div class="utility-collapsible-content" id="workout-tracker-content" style="display:none;">
              <div class="utility-card" style="margin-top:0;">
                <!-- Name Modal -->
                <div id="name-modal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.85);z-index:9999;align-items:center;justify-content:center;">
                  <div style="background:#222;border:2px solid #19baff;border-radius:12px;padding:32px 24px;max-width:340px;margin:auto;box-shadow:0 0 24px #19baff;display:flex;flex-direction:column;align-items:center;">
                    <h2 style="color:#19baff;font-family:'Orbitron',Arial,sans-serif;margin-bottom:18px;">Welcome!</h2>
                    <p style="color:#fff;margin-bottom:16px;text-align:center;">Enter your name to personalize your workout log:</p>
                    <input type="text" id="user-name-input" placeholder="Your Name" style="padding:12px;border-radius:6px;border:2px solid #19baff;background:#111;color:#fff;font-size:1.1rem;width:100%;margin-bottom:18px;" />
                    <button type="button" class="neon-btn neon-btn-blue" onclick="saveUserName()" style="width:100%;">Continue</button>
                  </div>
                </div>
                <h3 class="event-title" style="margin-bottom:18px;text-align:center;">Log Workout</h3>
                <form id="workout-form" style="display:flex;flex-direction:column;gap:16px;width:100%;max-width:500px;margin:0 auto;">
                  <div style="display:flex;align-items:center;gap:8px;">
                    <label for="workout-name" style="color:#19baff;font-family:'Orbitron',Arial,sans-serif;">Your Name: <span style="color:#ff5555;">*</span></label>
                    <input type="text" id="workout-name" placeholder="Enter your name" required style="padding:12px;border-radius:6px;border:2px solid #19baff;background:#222;color:#fff;font-size:1rem;flex:1;" aria-label="Your name" />
                    <button type="button" id="edit-name-btn" style="background:none;border:none;cursor:pointer;padding:0;margin-left:4px;" aria-label="Edit name">
                      <span style="font-size:1.3em;color:#19baff;">‚úèÔ∏è</span>
                    </button>
                  </div>
                  <div style="display:flex;flex-direction:column;gap:8px;">
                    <label for="workout-exercise" style="color:#19baff;font-family:'Orbitron',Arial,sans-serif;">Exercise: <span style="color:#ff5555;">*</span></label>
                    <select id="workout-exercise" style="padding:12px;border-radius:6px;border:2px solid #19baff;background:#222;color:#fff;font-size:1rem;font-family:'Orbitron',Arial,sans-serif;" aria-label="Select exercise">
                      <option value="">-- Select Exercise --</option>
                      <option value="bench-press">Bench Press</option>
                      <option value="incline-bench-press">Incline Bench Press</option>
                      <option value="front-squat">Front Squat</option>
                      <option value="back-squat">Back Squat</option>
                      <option value="romanian-deadlift">Romanian Deadlift</option>
                      <option value="deadlift">Deadlift</option>
                      <option value="clean-and-jerk">Clean & Jerk</option>
                      <option value="snatch">Snatch</option>
                      <option value="overhead-press">Overhead Press</option>
                      <option value="barbell-row">Barbell Row</option>
                      <option value="t-bar-row">T-Bar Row</option>
                      <option value="cable-row">Cable Row</option>
                      <option value="pullups">Pull-ups/Chin-ups</option>
                      <option value="dips">Dips</option>
                      <option value="bicep-curl">Bicep Curl</option>
                      <option value="tricep-extension">Tricep Extension</option>
                      <option value="lunges">Lunges</option>
                      <option value="hip-thrust">Hip Thrust</option>
                      <option value="goblet-squat">Goblet Squat</option>
                      <option value="push-up">Push-up</option>
                      <option value="plank">Plank</option>
                      <option value="farmer-walk">Farmer's Walk</option>
                      <option value="pull-down">Pull-down</option>
                      <option value="row">Row</option>
                      <option value="ski-erg">Ski-Erg</option>
                      <option value="row-erg">Row-Erg</option>
                      <option value="murph">Murph (WOD)</option>
                      <option value="fran">Fran (WOD)</option>
                      <option value="grace">Grace (WOD)</option>
                      <option value="cindy">Cindy (WOD)</option>
                      <option value="helen">Helen (WOD)</option>
                    </select>
                  </div>
                  <div style="display:flex;flex-direction:column;gap:8px;">
                    <label for="workout-date" style="color:#19baff;font-family:'Orbitron',Arial,sans-serif;">Date:</label>
                    <input type="date" id="workout-date" style="padding:12px;border-radius:6px;border:2px solid #19baff;background:#222;color:#fff;font-size:1rem;" aria-label="Workout date" />
                  </div>
                  <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
                    <div style="display:flex;flex-direction:column;gap:8px;">
                      <label for="workout-sets" style="color:#ffb84d;font-family:'Orbitron',Arial,sans-serif;">Sets:</label>
                      <input type="number" id="workout-sets" min="1" max="20" value="3" style="padding:12px;border-radius:6px;border:2px solid #ffb84d;background:#222;color:#fff;font-size:1rem;" aria-label="Number of sets" />
                    </div>
                    <div style="display:flex;flex-direction:column;gap:8px;">
                      <label for="workout-reps" style="color:#ffb84d;font-family:'Orbitron',Arial,sans-serif;">Reps:</label>
                      <input type="number" id="workout-reps" min="1" max="50" value="10" style="padding:12px;border-radius:6px;border:2px solid #ffb84d;background:#222;color:#fff;font-size:1rem;" aria-label="Number of reps" />
                    </div>
                  </div>
                  <div style="display:flex;flex-direction:column;gap:8px;">
                    <div id="workout-weight-row">
                      <div style="display:flex;justify-content:space-between;align-items:center;">
                        <label for="workout-weight" style="color:#39ff14;font-family:'Orbitron',Arial,sans-serif;">Weight:</label>
                        <div style="display:flex;gap:8px;">
                          <button type="button" id="unit-kg" class="neon-btn neon-btn-blue" onclick="setWeightUnit('kg')" style="padding:6px 12px;font-size:0.85rem;" aria-label="Set unit to kilograms" aria-pressed="true">KG</button>
                          <button type="button" id="unit-lb" class="neon-btn neon-btn-yellow" onclick="setWeightUnit('lb')" style="padding:6px 12px;font-size:0.85rem;opacity:0.5;" aria-label="Set unit to pounds" aria-pressed="false">LB</button>
                        </div>
                      </div>
                      <input type="number" id="workout-weight" min="0" max="1000" step="0.5" value="60" style="padding:12px;border-radius:6px;border:2px solid #39ff14;background:#222;color:#fff;font-size:1rem;margin-top:8px;width:100%;box-sizing:border-box;" aria-label="Weight lifted" />
                    </div>
                  </div>
                  <div style="display:flex;flex-direction:column;gap:8px;">
                    <label for="workout-notes" style="color:#fff;font-family:'Orbitron',Arial,sans-serif;">Notes (form cues, RPE, tempo):</label>
                    <textarea id="workout-notes" rows="3" style="padding:12px;border-radius:6px;border:2px solid #fff;background:#222;color:#fff;font-size:1rem;font-family:Arial,sans-serif;resize:vertical;" placeholder="e.g., RPE 8, controlled tempo, good form" aria-label="Workout notes"></textarea>
                  </div>
                  <!-- 1k Time field for Ski-Erg and Row-Erg -->
                  <div id="time-row" style="display:none;flex-direction:column;gap:8px;">
                    <label for="workout-time" style="color:#ffb84d;font-family:'Orbitron',Arial,sans-serif;">1k Time (mm:ss):</label>
                    <input type="text" id="workout-time" pattern="^\d{1,2}:\d{2}$" placeholder="e.g. 03:45" style="padding:12px;border-radius:6px;border:2px solid #ffb84d;background:#222;color:#fff;font-size:1rem;" aria-label="1k time in minutes and seconds" />
                  </div>
                  <!-- Distance/Time fields for Ski-Erg and Row-Erg (removed distance field) -->
                  <div id="distance-time-row" style="display:none;flex-direction:column;gap:8px;">
                    <label for="workout-distance" style="color:#19baff;font-family:'Orbitron',Arial,sans-serif;">Distance (meters):</label>
                    <input type="number" id="workout-distance" min="0" max="10000" step="1" style="padding:12px;border-radius:6px;border:2px solid #19baff;background:#222;color:#fff;font-size:1rem;" aria-label="Distance in meters" />
                    <label for="workout-time" style="color:#ffb84d;font-family:'Orbitron',Arial,sans-serif;">Time (mm:ss):</label>
                    <input type="text" id="workout-time" pattern="^\d{1,2}:\d{2}$" placeholder="e.g. 07:30" style="padding:12px;border-radius:6px;border:2px solid #ffb84d;background:#222;color:#fff;font-size:1rem;" aria-label="Time in minutes and seconds" />
                  </div>
                  <div style="display:flex;gap:12px;flex-wrap:wrap;justify-content:center;">
                    <button type="button" class="neon-btn neon-btn-blue" id="save-workout-btn" onclick="saveWorkout()" aria-label="Save workout entry" style="flex:1;min-width:120px;">Save Entry</button>
                    <button type="button" class="neon-btn neon-btn-yellow" onclick="exportWorkouts()" aria-label="Export workouts as CSV" style="flex:1;min-width:120px;">Export CSV</button>
                  </div>
                </form>
                <div id="workout-submit-message" style="margin-top:16px;padding:12px;border-radius:8px;font-family:'Orbitron',Arial,sans-serif;text-align:center;display:none;" role="alert" aria-live="polite"></div>
                <div id="workout-pr-message" style="margin-top:16px;padding:12px;border-radius:8px;background:rgba(57,255,20,0.1);border:2px solid #39ff14;color:#39ff14;font-family:'Orbitron',Arial,sans-serif;text-align:center;display:none;" role="alert" aria-live="assertive">
                  üèÜ NEW PERSONAL RECORD! üèÜ
                </div>
              </div>
            </div>
          </div>
          <!-- Progress Chart -->
          <div class="utility-collapsible">
            <button class="utility-collapsible-header" onclick="toggleUtilitySection('progress-chart')" aria-expanded="false" aria-controls="progress-chart-content">
              <span class="section-icon" aria-hidden="true">üìà</span> Progress Chart
            </button>
            <div class="utility-collapsible-content" id="progress-chart-content" style="display:none;">
              <div class="utility-card" style="margin-top:0;">
                <div class="stats-placeholder">
                  <div class="stat-box">
                    <div class="stat-value" id="total-workouts">0</div>
                    <div class="stat-label">Total Workouts</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value" id="total-prs">0</div>
                    <div class="stat-label">Personal Records</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value" id="this-week">0</div>
                    <div class="stat-label">This Week</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value" id="streak">0</div>
                    <div class="stat-label">Day Streak</div>
                  </div>
                </div>
                <h3 style="color:#19baff;font-family:'Orbitron',Arial,sans-serif;text-align:center;margin-bottom:16px;">Progress Chart</h3>
                <div style="display:flex;flex-direction:column;gap:8px;margin-bottom:16px;">
                  <label for="chart-exercise" style="color:#19baff;font-family:'Orbitron',Arial,sans-serif;">Select Exercise to View:</label>
                  <select id="chart-exercise" onchange="updateChart()" style="padding:12px;border-radius:6px;border:2px solid #19baff;background:#222;color:#fff;font-size:1rem;font-family:'Orbitron',Arial,sans-serif;" aria-label="Select exercise for chart">
                    <option value="">-- Select Exercise --</option>
                    <option value="bench-press">Bench Press</option>
                    <option value="front-squat">Front Squat</option>
                    <option value="back-squat">Back Squat</option>
                    <option value="squat">Squat</option>
                    <option value="deadlift">Deadlift</option>
                    <option value="overhead-press">Overhead Press</option>
                    <option value="barbell-row">Barbell Row</option>
                    <option value="pullups">Pull-ups/Chin-ups</option>
                    <option value="dips">Dips</option>
                    <option value="bicep-curl">Bicep Curl</option>
                    <option value="tricep-extension">Tricep Extension</option>
                    <option value="lunges">Lunges</option>
                  </select>
                </div>
                <canvas id="workout-chart" style="max-height:300px;"></canvas>
              </div>
            </div>
          </div>
          <!-- PB Matrix (Personal Bests) -->
          <div class="utility-collapsible">
            <!-- PB Matrix section removed. -->
            </div>
          </div>
          <!-- CrossFit Timer -->
          <div class="utility-collapsible">
            <button class="utility-collapsible-header" onclick="toggleUtilitySection('crossfit-timer')" aria-expanded="false" aria-controls="crossfit-timer-content">
              <span class="section-icon" aria-hidden="true">‚è±Ô∏è</span> CrossFit Timer
            </button>
            <div class="utility-collapsible-content" id="crossfit-timer-content" style="display:none;">
              <div class="utility-card" style="margin-top:0;">
                <h3 class="event-title" style="margin-bottom:18px;text-align:center;">CrossFit Timer</h3>
                <div id="timer-list" style="display:flex;flex-direction:column;gap:18px;margin:24px 0;">
                  <button class="timer-mode-btn" onclick="selectTimerMode('clock')" aria-label="Select Clock mode">CLOCK</button>
                  <button class="timer-mode-btn" onclick="selectTimerMode('tabata')" aria-label="Select Tabata mode">TABATA</button>
                  <button class="timer-mode-btn" onclick="selectTimerMode('fortime')" aria-label="Select For Time mode">FOR TIME</button>
                  <button class="timer-mode-btn" onclick="selectTimerMode('emom')" aria-label="Select EMOM mode">EMOM</button>
                  <button class="timer-mode-btn" onclick="selectTimerMode('amrap')" aria-label="Select AMRAP mode">AMRAP</button>
                </div>
                <div id="timer-mode-ui" style="display:none;"></div>
              </div>
            </div>
          </div>
          <!-- One Rep Max Calculator -->
          <div class="utility-collapsible">
            <button class="utility-collapsible-header" onclick="toggleUtilitySection('orm-calculator')" aria-expanded="false" aria-controls="orm-calculator-content">
              <span class="section-icon" aria-hidden="true">üí™</span> One Rep Max Calculator (KG)
            </button>
            <div class="utility-collapsible-content" id="orm-calculator-content" style="display:none;">
              <div class="utility-card" style="margin-top:0;">
                <h3 class="event-title" style="margin-bottom:18px;text-align:center;">One Rep Max Calculator (KG)</h3>
                <form id="orm-form" style="display:flex;flex-direction:column;gap:16px;align-items:center;">
                  <div style="display:flex;gap:12px;align-items:center;">
                    <label for="orm-weight" style="color:#19baff;font-family:'Orbitron',Arial,sans-serif;">Weight (kg):</label>
                    <input type="number" id="orm-weight" min="1" max="500" value="60" style="width:80px;padding:6px 8px;border-radius:6px;border:1px solid #19baff;background:#222;color:#fff;" aria-label="Weight in kilograms" />
                  </div>
                  <div style="display:flex;flex-direction:column;align-items:center;width:100%;">
                    <div style="display:flex;gap:8px;margin-bottom:8px;flex-wrap:wrap;justify-content:center;">
                      <button type="button" class="neon-btn neon-btn-blue" onclick="setORMReps(1)" aria-label="Set reps to 1">1</button>
                      <button type="button" class="neon-btn neon-btn-blue" onclick="setORMReps(3)" aria-label="Set reps to 3">3</button>
                      <button type="button" class="neon-btn neon-btn-blue" onclick="setORMReps(5)" aria-label="Set reps to 5">5</button>
                      <button type="button" class="neon-btn neon-btn-yellow" onclick="setORMReps(8)" aria-label="Set reps to 8">8</button>
                      <button type="button" class="neon-btn neon-btn-yellow" onclick="setORMReps(10)" aria-label="Set reps to 10">10</button>
                    </div>
                    <div style="display:flex;gap:12px;align-items:center;">
                      <label for="orm-reps" style="color:#ffb84d;font-family:'Orbitron',Arial,sans-serif;">Reps:</label>
                      <input type="number" id="orm-reps" min="1" max="20" value="5" style="width:60px;padding:6px 8px;border-radius:6px;border:1px solid #ffb84d;background:#222;color:#fff;" aria-label="Number of repetitions" />
                    </div>
                  </div>
                  <div style="display:flex;gap:12px;align-items:center;">
                    <label for="orm-formula" style="color:#39ff14;font-family:'Orbitron',Arial,sans-serif;">Formula:</label>
                    <select id="orm-formula" style="padding:6px 8px;border-radius:6px;border:1px solid #39ff14;background:#222;color:#fff;" aria-label="Select calculation formula">
                      <option value="epley">Epley</option>
                      <option value="all">All</option>
                      <option value="brzycki">Brzycki</option>
                      <option value="lombardi">Lombardi</option>
                      <option value="oconner">O'Conner</option>
                    </select>
                  </div>
                  <button type="button" class="neon-btn neon-btn-blue" onclick="calculateORM()" aria-label="Calculate one rep max">Calculate 1RM</button>
                </form>
                <div id="orm-result" style="margin-top:18px;font-size:1.2rem;color:#39ff14;text-align:center;font-family:'Orbitron',Arial,sans-serif;" role="status" aria-live="polite"></div>
              </div>
            </div>
          </div>
          <!-- Community Tools -->
          <div class="utility-collapsible">
            <button class="utility-collapsible-header" onclick="toggleUtilitySection('community-tools')" aria-expanded="false" aria-controls="community-tools-content">
              <span class="section-icon" aria-hidden="true">üë•</span> Community Tools
            </button>
            <div class="utility-collapsible-content" id="community-tools-content" style="display:none;">
              <div class="utility-card" style="margin-top:0;">
                <a href="events.html" class="utility-link">
                  <span class="link-icon" aria-hidden="true">üìÖ</span>
                  <span class="link-text">Events Calendar</span>
                  <span class="link-arrow" aria-hidden="true">‚Üí</span>
                </a>
                <a href="#" class="utility-link" aria-label="Access community leaderboard (coming soon)">
                  <span class="link-icon" aria-hidden="true">üèÜ</span>
                  <span class="link-text">Community Leaderboard</span>
                  <span class="link-arrow" aria-hidden="true">‚Üí</span>
                </a>
                <a href="pb-matrix.html" class="utility-link" aria-label="View Personal Bests Matrix">
                  <span class="link-icon" aria-hidden="true">üìä</span>
                  <span class="link-text">Personal Bests Matrix</span>
                  <span class="link-arrow" aria-hidden="true">‚Üí</span>
                </a>
                <a href="#" class="utility-link" aria-label="Access shared workout spreadsheets (coming soon)">
                  <span class="link-icon" aria-hidden="true">üìã</span>
                  <span class="link-text">Shared Workout Sheets</span>
                  <span class="link-arrow" aria-hidden="true">‚Üí</span>
                </a>
                <a href="#" class="utility-link" aria-label="Challenge sign-up forms (coming soon)">
                  <span class="link-icon" aria-hidden="true">‚úçÔ∏è</span>
                  <span class="link-text">Challenge Sign-up Forms</span>
                  <span class="link-arrow" aria-hidden="true">‚Üí</span>
                </a>
              </div>
            </div>
          </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="site-footer" role="contentinfo">
      <div class="footer-content">
        <nav class="footer-social" aria-label="Social media links">
          <a href="https://instagram.com" target="_blank" rel="noopener noreferrer" aria-label="Follow us on Instagram">
            <img src="https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/instagram.svg" alt="Instagram" style="width:28px;height:28px;vertical-align:middle;filter:drop-shadow(0 0 4px #e1306c);" />
          </a>
          <a href="https://facebook.com" target="_blank" rel="noopener noreferrer" aria-label="Follow us on Facebook">
            <img src="https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/facebook.svg" alt="Facebook" style="width:28px;height:28px;vertical-align:middle;filter:drop-shadow(0 0 4px #1877f3);" />
          </a>
          <a href="https://twitter.com" target="_blank" rel="noopener noreferrer" aria-label="Follow us on Twitter">
            <img src="https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/twitter.svg" alt="Twitter" style="width:28px;height:28px;vertical-align:middle;filter:drop-shadow(0 0 4px #1da1f2);" />
          </a>
        </nav>
        <p class="footer-copyright">
          &copy; <span id="current-year">2024</span> Iron & Ale. All rights reserved.
        </p>
      </div>
    </footer>
  </div>

  <script>
    // Set current year in footer
    document.getElementById('current-year').textContent = new Date().getFullYear();

    // One Rep Max Calculator (multiple formulas)
    function setORMReps(val) {
      document.getElementById('orm-reps').value = val;
    }

    // Timer duration quick select
    function setTimerDuration(minutes) {
      const input = document.getElementById('timer-duration');
      if (input) {
        input.value = minutes;
        timerSeconds = minutes * 60;
        updateTimerDisplay();
      }
    }

    // Fullscreen toggle
    function toggleFullscreen() {
      const timerDisplay = document.getElementById('timer-display') || document.getElementById('emom-timer');
      if (!timerDisplay) return;
      // Always fullscreen the closest .utility-card for timer
      const utilityCard = timerDisplay.closest('.utility-card');
      if (!document.fullscreenElement) {
        if (utilityCard && utilityCard.requestFullscreen) {
          utilityCard.requestFullscreen().catch(err => {
            console.log('Fullscreen request failed:', err);
          });
        }
      } else {
        if (document.exitFullscreen) {
          document.exitFullscreen();
        }
      }
    }

    function calculateORM() {
      const weight = parseFloat(document.getElementById('orm-weight').value);
      const reps = parseInt(document.getElementById('orm-reps').value);
      const formula = document.getElementById('orm-formula').value;
      if (isNaN(weight) || isNaN(reps) || weight <= 0 || reps <= 0) {
        document.getElementById('orm-result').textContent = 'Please enter valid values.';
        document.getElementById('orm-result').style.color = '#ff5555';
        return;
      }
      // Formulas
      const results = [];
      let oneRM = 0;
      if (formula === 'all' || formula === 'epley') {
        // Epley: 1RM = weight * (1 + reps/30)
        const epley = weight * (1 + reps / 30);
        results.push(`<span style='color:#19baff;'>Epley:</span> <b>${epley.toFixed(1)} kg</b>`);
        if (formula === 'epley') oneRM = epley;
      }
      if (formula === 'all' || formula === 'brzycki') {
        // Brzycki: 1RM = weight * (36 / (37 - reps))
        const brzycki = weight * (36 / (37 - reps));
        results.push(`<span style='color:#ffb84d;'>Brzycki:</span> <b>${brzycki.toFixed(1)} kg</b>`);
        if (formula === 'brzycki') oneRM = brzycki;
      }
      if (formula === 'all' || formula === 'lombardi') {
        // Lombardi: 1RM = weight * reps^0.10
        const lombardi = weight * Math.pow(reps, 0.10);
        results.push(`<span style='color:#39ff14;'>Lombardi:</span> <b>${lombardi.toFixed(1)} kg</b>`);
        if (formula === 'lombardi') oneRM = lombardi;
      }
      if (formula === 'all' || formula === 'oconner') {
        // O'Conner: 1RM = weight * (1 + 0.025 * reps)
        const oconner = weight * (1 + 0.025 * reps);
        results.push(`<span style='color:#ff5555;'>O'Conner:</span> <b>${oconner.toFixed(1)} kg</b>`);
        if (formula === 'oconner') oneRM = oconner;
      }
      
      // If "All" is selected, calculate average for percentages
      if (formula === 'all') {
        const epley = weight * (1 + reps / 30);
        const brzycki = weight * (36 / (37 - reps));
        const lombardi = weight * Math.pow(reps, 0.10);
        const oconner = weight * (1 + 0.025 * reps);
        oneRM = (epley + brzycki + lombardi + oconner) / 4;
      }
      
      // Add training percentages
      if (oneRM > 0) {
        results.push('<br><span style="color:#39ff14;font-size:1rem;">Training Percentages:</span>');
        const percentages = [95, 90, 85, 80, 75, 70, 65, 60];
        const percentList = percentages.map(p => 
          `<span style="color:#19baff;">${p}%:</span> ${(oneRM * p / 100).toFixed(1)} kg`
        ).join(' | ');
        results.push(`<div style="font-size:0.9rem;margin-top:8px;line-height:1.6;">${percentList}</div>`);
      }
      
      document.getElementById('orm-result').innerHTML = results.join('<br>');
      document.getElementById('orm-result').style.color = '#39ff14';
    }

    // CrossFit Timer functionality
    let timerInterval = null;
    let timerSeconds = 0;
    let timerMode = '';

    function selectTimerMode(mode) {
      timerMode = mode;
      clearInterval(timerInterval);
      timerSeconds = 0;
      
      const timerList = document.getElementById('timer-list');
      const timerUI = document.getElementById('timer-mode-ui');
      
      if (timerList && timerUI) {
        timerList.style.display = 'none';
        timerUI.style.display = 'block';
        
        // Remove flip-in class if it exists (to allow re-triggering)
        timerUI.classList.remove('flip-in');
        
        // Force reflow to ensure class removal takes effect before re-adding
        // This is necessary for the animation to restart on repeated selections
        timerUI.offsetWidth;
        
        // Add flip-in class to trigger animation
        timerUI.classList.add('flip-in');
      }
      
      let backArrow = `<button onclick="backToTimerList()" aria-label="Back to timer list" style="position:absolute;top:12px;left:12px;background:none;border:none;color:#19baff;font-size:2rem;z-index:10;cursor:pointer;">&#8592;</button>`;
      let wrapperStart = `<div style='position:relative;'>${backArrow}`;
      let wrapperEnd = `</div>`;
      let timerDisplayStyle = "font-size:3.5rem;color:#19baff;font-family:'Orbitron',Arial,sans-serif;text-shadow:0 0 16px #19baff;margin:24px 0;background:#111;padding:16px 0;border-radius:12px;box-shadow:0 0 24px #19baff;letter-spacing:0.1em;";
      let timerDisplayDiv = `<div style='position:relative;'><div style='${timerDisplayStyle}' id='timer-display'>00:00</div><button class='neon-btn neon-btn-blue' onclick='toggleFullscreen()' style='position:absolute;top:0;right:0;padding:8px 12px;font-size:0.8rem;' aria-label='Toggle fullscreen mode'>‚õ∂</button></div>`;
      let minuteBtnRowStyle = "display:flex;gap:4px;justify-content:center;margin-bottom:8px;flex-wrap:wrap;";
      let ormBtnStyle = "padding:4px 8px;font-size:0.95rem;min-width:28px;min-height:28px;border-radius:8px;margin:0 2px;box-shadow:0 0 6px #19baff44;";
      if (mode === 'clock') {
        timerUI.innerHTML = `${wrapperStart}
          <div style='text-align:center;'>
            ${timerDisplayDiv}
            <div style='display:flex;gap:12px;justify-content:center;flex-wrap:wrap;'>
              <button class='neon-btn neon-btn-blue' onclick='startTimer()' aria-label='Start timer'>Start</button>
              <button class='neon-btn neon-btn-yellow' onclick='pauseTimer()' aria-label='Pause timer'>Pause</button>
              <button class='neon-btn neon-btn-blue' onclick='resetTimer()' aria-label='Reset timer'>Reset</button>
            </div>
          </div>
        ${wrapperEnd}`;
      } else if (mode === 'emom') {
        timerUI.innerHTML = `${wrapperStart}
          <div style='text-align:center;'>
            <label style='color:#19baff;'>Minutes:</label>
            <div style='${minuteBtnRowStyle}'>
              <button type='button' class='neon-btn neon-btn-blue orm-rep-btn' style='${ormBtnStyle}' onclick='setEMOMMins(1)' aria-label='Set EMOM to 1 minute'>1</button>
              <button type='button' class='neon-btn neon-btn-blue orm-rep-btn' style='${ormBtnStyle}' onclick='setEMOMMins(2)' aria-label='Set EMOM to 2 minutes'>2</button>
              <button type='button' class='neon-btn neon-btn-blue orm-rep-btn' style='${ormBtnStyle}' onclick='setEMOMMins(3)' aria-label='Set EMOM to 3 minutes'>3</button>
              <button type='button' class='neon-btn neon-btn-yellow orm-rep-btn' style='${ormBtnStyle}' onclick='setEMOMMins(4)' aria-label='Set EMOM to 4 minutes'>4</button>
              <button type='button' class='neon-btn neon-btn-yellow orm-rep-btn' style='${ormBtnStyle}' onclick='setEMOMMins(5)' aria-label='Set EMOM to 5 minutes'>5</button>
            </div>
            <input type='number' id='emom-mins' min='1' max='60' value='1' style='width:50px;' aria-label='EMOM minutes' />
            <div style='margin:12px 0;'>
              <label style='color:#39ff14;'>Rounds:</label>
              <input type='number' id='emom-rounds' min='1' max='50' value='10' style='width:60px;padding:4px;border-radius:4px;border:1px solid #39ff14;background:#222;color:#fff;' aria-label='Number of EMOM rounds'>
            </div>
            <div style='position:relative;'>
              <div id='emom-timer' style='${timerDisplayStyle}'>01:00</div>
              <button class='neon-btn neon-btn-blue' onclick='toggleFullscreen()' style='position:absolute;top:0;right:0;padding:8px 12px;font-size:0.8rem;' aria-label='Toggle fullscreen mode'>‚õ∂</button>
            </div>
            <div id='emom-round' style='margin-bottom:8px;color:#39ff14;' role='status' aria-live='polite'>Round 1</div>
            <div style='display:flex;gap:12px;justify-content:center;flex-wrap:wrap;'>
              <button class='neon-btn neon-btn-blue' onclick='startEMOMTimer()' aria-label='Start EMOM timer'>Start</button>
              <button class='neon-btn neon-btn-yellow' onclick='pauseEMOMTimer()' aria-label='Pause EMOM timer'>Pause</button>
              <button class='neon-btn neon-btn-blue' onclick='resetEMOMTimer()' aria-label='Reset EMOM timer'>Reset</button>
            </div>
          </div>
        ${wrapperEnd}`;
        window.emomTimer = 60;
        window.emomInterval = null;
        window.emomPaused = false;
        window.emomRound = 1;
        window.emomTotalRounds = 10;
        updateEMOMDisplay();
      } else if (mode === 'fortime' || mode === 'amrap') {
        const label = mode === 'fortime' ? 'For Time' : 'AMRAP';
        timerUI.innerHTML = `${wrapperStart}
          <div style='text-align:center;'>
            <div style='margin:16px 0;'>
              <label style='color:#19baff;'>Duration (minutes): </label>
              <div style='${minuteBtnRowStyle}'>
                <button type='button' class='neon-btn neon-btn-blue orm-rep-btn' style='${ormBtnStyle}' onclick='setTimerDuration(1)' aria-label='Set timer to 1 minute'>1</button>
                <button type='button' class='neon-btn neon-btn-blue orm-rep-btn' style='${ormBtnStyle}' onclick='setTimerDuration(2)' aria-label='Set timer to 2 minutes'>2</button>
                <button type='button' class='neon-btn neon-btn-blue orm-rep-btn' style='${ormBtnStyle}' onclick='setTimerDuration(3)' aria-label='Set timer to 3 minutes'>3</button>
                <button type='button' class='neon-btn neon-btn-yellow orm-rep-btn' style='${ormBtnStyle}' onclick='setTimerDuration(4)' aria-label='Set timer to 4 minutes'>4</button>
                <button type='button' class='neon-btn neon-btn-yellow orm-rep-btn' style='${ormBtnStyle}' onclick='setTimerDuration(5)' aria-label='Set timer to 5 minutes'>5</button>
              </div>
              <input type='number' id='timer-duration' value='20' min='1' max='180' style='width:60px;padding:4px;border-radius:4px;border:1px solid #19baff;background:#222;color:#fff;' aria-label='Timer duration in minutes'>
            </div>
            <div style='position:relative;'>
              <div style='${timerDisplayStyle}' id='timer-display'>20:00</div>
              <button class='neon-btn neon-btn-blue' onclick='toggleFullscreen()' style='position:absolute;top:0;right:0;padding:8px 12px;font-size:0.8rem;' aria-label='Toggle fullscreen mode'>‚õ∂</button>
            </div>
            <div style='display:flex;gap:12px;justify-content:center;flex-wrap:wrap;'>
              <button class='neon-btn neon-btn-blue' onclick='startCountdown()' aria-label='Start timer'>Start</button>
              <button class='neon-btn neon-btn-yellow' onclick='pauseTimer()' aria-label='Pause timer'>Pause</button>
              <button class='neon-btn neon-btn-blue' onclick='resetTimer()' aria-label='Reset timer'>Reset</button>
            </div>
          </div>
        ${wrapperEnd}`;
        timerSeconds = 20 * 60;
        updateTimerDisplay();
      } else if (mode === 'tabata') {
        timerUI.innerHTML = `${wrapperStart}
          <div style='text-align:center;'>
            <div style='margin:16px 0;display:flex;flex-direction:column;gap:12px;align-items:center;'>
              <div style='display:flex;gap:12px;align-items:center;'>
                <label style='color:#19baff;'>Work:</label>
                <input type='number' id='tabata-work' value='20' min='1' max='180' style='width:60px;padding:4px;border-radius:4px;border:1px solid #19baff;background:#222;color:#fff;' aria-label='Work duration in seconds'>
              </div>
              <div style='display:flex;gap:12px;align-items:center;'>
                <label style='color:#ffb84d;'>Rest:</label>
                <input type='number' id='tabata-rest' value='10' min='1' max='180' style='width:60px;padding:4px;border-radius:4px;border:1px solid #ffb84d;background:#222;color:#fff;' aria-label='Rest duration in seconds'>
              </div>
              <div style='display:flex;gap:12px;align-items:center;'>
                <label style='color:#39ff14;'>Rounds:</label>
                <input type='number' id='tabata-rounds' value='8' min='1' max='50' style='width:60px;padding:4px;border-radius:4px;border:1px solid #39ff14;background:#222;color:#fff;' aria-label='Number of rounds'>
              </div>
            </div>
            <div style='position:relative;'>
              <div style='${timerDisplayStyle}' id='timer-display'>20</div>
              <button class='neon-btn neon-btn-blue' onclick='toggleFullscreen()' style='position:absolute;top:0;right:0;padding:8px 12px;font-size:0.8rem;' aria-label='Toggle fullscreen mode'>‚õ∂</button>
            </div>
            <div style='display:flex;gap:12px;justify-content:center;flex-wrap:wrap;'>
              <button class='neon-btn neon-btn-blue' onclick='startTabata()' aria-label='Start Tabata timer'>Start</button>
              <button class='neon-btn neon-btn-yellow' onclick='pauseTimer()' aria-label='Pause Tabata timer'>Pause</button>
              <button class='neon-btn neon-btn-blue' onclick='resetTimer()' aria-label='Reset Tabata timer'>Reset</button>
            </div>
          </div>
        ${wrapperEnd}`;
        timerSeconds = 20;
        updateTimerDisplay();
      }
    }

    function backToTimerList() {
      document.getElementById('timer-list').style.display = 'flex';
      document.getElementById('timer-mode-ui').style.display = 'none';
      clearInterval(timerInterval);
      timerMode = '';
    }

    function startTabata() {
      const work = parseInt(document.getElementById('tabata-work').value);
      const rest = parseInt(document.getElementById('tabata-rest').value);
      const rounds = parseInt(document.getElementById('tabata-rounds').value);
      
      let currentRound = 1;
      let isWork = true;
      timerSeconds = work;
      
      clearInterval(timerInterval);
      updateTimerDisplay();
      
      timerInterval = setInterval(() => {
        timerSeconds--;
        
        if (timerSeconds <= 0) {
          if (isWork) {
            // Switch to rest
            isWork = false;
            timerSeconds = rest;
            document.getElementById('timer-display').style.color = '#ffb84d';
          } else {
            // Move to next round
            currentRound++;
            if (currentRound > rounds) {
              clearInterval(timerInterval);
              document.getElementById('timer-display').textContent = 'DONE!';
              document.getElementById('timer-display').style.color = '#39ff14';
              return;
            }
            isWork = true;
            timerSeconds = work;
            document.getElementById('timer-display').style.color = '#19baff';
          }
        }
        updateTimerDisplay();
      }, 1000);
    }

    function startEMOM() {
      const rounds = parseInt(document.getElementById('emom-rounds').value);
      let currentRound = 1;
      timerSeconds = 60;
      
      clearInterval(timerInterval);
      document.getElementById('timer-display').textContent = `Round ${currentRound} - 01:00`;
      
      timerInterval = setInterval(() => {
        timerSeconds--;
        
        if (timerSeconds <= 0) {
          currentRound++;
          if (currentRound > rounds) {
            clearInterval(timerInterval);
            document.getElementById('timer-display').textContent = 'DONE!';
            document.getElementById('timer-display').style.color = '#39ff14';
            return;
          }
          timerSeconds = 60;
        }
        
        const mins = Math.floor(timerSeconds / 60);
        const secs = timerSeconds % 60;
        document.getElementById('timer-display').textContent = `Round ${currentRound} - ${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
      }, 1000);
    }

    // EMOM Timer Functions
    function setEMOMMins(val) {
      const input = document.getElementById('emom-mins');
      if (input) {
        input.value = val;
        window.emomTimer = val * 60;
        window.emomTotalRounds = val;
        updateEMOMDisplay();
      }
    }

    function updateEMOMDisplay() {
      const display = document.getElementById('emom-timer');
      const roundDisplay = document.getElementById('emom-round');
      if (display) {
        const mins = Math.floor(window.emomTimer / 60);
        const secs = window.emomTimer % 60;
        display.textContent = `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
      }
      if (roundDisplay) {
        roundDisplay.textContent = `Round ${window.emomRound}`;
      }
    }

    function startEMOMTimer() {
      if (window.emomInterval) return; // Already running
      
      window.emomPaused = false;
      const totalMinutes = parseInt(document.getElementById('emom-mins').value) || 1;
      window.emomTotalRounds = totalMinutes;
      
      window.emomInterval = setInterval(() => {
        if (!window.emomPaused) {
          window.emomTimer--;
          updateEMOMDisplay();
          
          if (window.emomTimer <= 0) {
            // Round complete
            if (window.emomRound >= window.emomTotalRounds) {
              // Workout complete
              clearInterval(window.emomInterval);
              window.emomInterval = null;
              document.getElementById('emom-timer').textContent = 'DONE!';
              document.getElementById('emom-timer').style.color = '#39ff14';
              // Play completion sound
              try {
                const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIF2i78OShUBEMUKvl8LdjHAU7k9n0zn4vBSh+zPLaizsKGGS56+ynVRQKRp/g8r5sIQUrgs7y2Ik2CBdou/DkoVARC1Cr5fC3YxwFO5PZ9M5+LwUofszy2os7ChhluevrqFYVC0af4PK+bCEFLIHO8tiJNggXaLvw5KFQEQtQq+Xwt2McBTuT2fTOfi8FKH7M8tqLOwoYZbnr66hWFQtGn+DyvmwhBSyBzvLYiTYIF2i78OShUBELUKvl8LdjHAU7k9n0zn4vBSh+zPLaizsKGGW56+uoVhULRp/g8r5sIQUsgs7y2Ik2CBdou/DkoVARC1Cr5fC3YxwFO5PZ9M5+LwUofszy2os7ChhluevrqFYVC0af4PK+bCEFLILO8tiJNggXaLvw5KFQEQtQq+Xwt2McBTuT2fTOfi8FKH7M8tqLOwoYZbnr66hWFQ==');
                audio.play();
              } catch (e) {
                console.log('Audio play failed:', e);
              }
              return;
            }
            // Next round
            window.emomRound++;
            window.emomTimer = 60;
            updateEMOMDisplay();
          }
        }
      }, 1000);
    }

    function pauseEMOMTimer() {
      window.emomPaused = !window.emomPaused;
    }

    function resetEMOMTimer() {
      clearInterval(window.emomInterval);
      window.emomInterval = null;
      window.emomPaused = false;
      window.emomRound = 1;
      const minutes = parseInt(document.getElementById('emom-mins').value) || 1;
      window.emomTimer = 60;
      window.emomTotalRounds = minutes;
      updateEMOMDisplay();
      const display = document.getElementById('emom-timer');
      if (display) {
        display.style.color = '#19baff';
      }
    }

    // Workout Tracker Functions
    let workoutUnit = 'kg';
    let workoutChart = null;

    // Initialize workout tracker
    function initWorkoutTracker() {
            // Hide/show weight and time input based on exercise
            const exerciseInput = document.getElementById('workout-exercise');
            const weightRow = document.getElementById('workout-weight-row');
            const setsRow = document.getElementById('workout-sets').parentElement.parentElement;
            const repsRow = document.getElementById('workout-reps').parentElement.parentElement;
            const timeRow = document.getElementById('time-row');
            function updateFieldVisibility() {
              const val = exerciseInput.value;
              if (val === 'ski-erg' || val === 'row-erg') {
                if (weightRow) weightRow.style.display = 'none';
                if (setsRow) setsRow.style.display = 'none';
                if (repsRow) repsRow.style.display = 'none';
                if (timeRow) {
                  // Move timeRow to sets/reps location
                  setsRow.parentElement.insertBefore(timeRow, setsRow);
                  timeRow.style.display = '';
                }
              } else if (val === 'pullups' || val === 'dips') {
                if (weightRow) weightRow.style.display = 'none';
                if (setsRow) setsRow.style.display = '';
                if (repsRow) repsRow.style.display = '';
                if (timeRow) timeRow.style.display = 'none';
              } else {
                if (weightRow) weightRow.style.display = '';
                if (setsRow) setsRow.style.display = '';
                if (repsRow) repsRow.style.display = '';
                if (timeRow) timeRow.style.display = 'none';
              }
            }
            if (exerciseInput && weightRow && setsRow && repsRow && timeRow) {
              exerciseInput.addEventListener('change', updateFieldVisibility);
              updateFieldVisibility();
            }
      // Set today's date
      const dateInput = document.getElementById('workout-date');
      if (dateInput) {
        const today = new Date().toISOString().split('T')[0];
        dateInput.value = today;
      }
      // Initialize chart
      const ctx = document.getElementById('workout-chart');
      if (ctx) {
        workoutChart = new Chart(ctx, {
          type: 'line',
          data: {
            labels: [],
            datasets: [{
              label: 'Weight',
              data: [],
              borderColor: '#19baff',
              backgroundColor: 'rgba(25, 186, 255, 0.1)',
              borderWidth: 2,
              tension: 0.3,
              pointRadius: 6,
              pointHoverRadius: 8,
              pointBackgroundColor: '#19baff',
              pointBorderColor: '#fff',
              pointBorderWidth: 2
            }]
          },
                options: {
                  responsive: true,
                  maintainAspectRatio: true,
                  plugins: {
                    legend: {
                      display: true,
                      labels: {
                        color: '#19baff',
                        font: {
                          family: "'Orbitron', Arial, sans-serif"
                        }
                      }
                    }
                  },
                  scales: {
                    y: {
                      beginAtZero: false,
                      ticks: {
                        color: '#19baff'
                      },
                      grid: {
                        color: 'rgba(25, 186, 255, 0.1)'
                      }
                    },
                    x: {
                      ticks: {
                        color: '#19baff'
                      },
                      grid: {
                        color: 'rgba(25, 186, 255, 0.1)'
                      }
                    }
                  }
                }
              });
            }
            // Load existing workouts
            updateStats();
            updateChart();
          }
      
          // Check for stored user name on page load
          window.addEventListener('DOMContentLoaded', function() {
            const storedName = localStorage.getItem('ironale_username');
            if (!storedName) {
              const modal = document.getElementById('name-modal');
              if (modal) {
                modal.style.display = 'flex';
              }
            } else {
              const nameInput = document.getElementById('workout-name');
              if (nameInput) {
                nameInput.value = storedName;
              }
            }
            initWorkoutTracker();
          });
      
          // Save user name from modal
          function saveUserName() {
            const input = document.getElementById('user-name-input');
            const name = input ? input.value.trim() : '';
            if (!name) {
              alert('Please enter your name');
              return;
            }
            localStorage.setItem('ironale_username', name);
            const nameInput = document.getElementById('workout-name');
            if (nameInput) {
              nameInput.value = name;
            }
            const modal = document.getElementById('name-modal');
            if (modal) {
              modal.style.display = 'none';
            }
          }
      
          // Edit name button
          document.addEventListener('DOMContentLoaded', function() {
            const editBtn = document.getElementById('edit-name-btn');
            if (editBtn) {
              editBtn.addEventListener('click', function() {
                const modal = document.getElementById('name-modal');
                const input = document.getElementById('user-name-input');
                const currentName = document.getElementById('workout-name').value;
                if (input) input.value = currentName;
                if (modal) modal.style.display = 'flex';
              });
            }
          });
  </script>
  <script src="assets/js/main.js"></script>
</body>
</html>
