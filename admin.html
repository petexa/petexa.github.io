<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin | Iron & Ale</title>
  <meta name="description" content="Iron & Ale admin tools - Webhook testing and PB Matrix URL validation.">
  <link rel="stylesheet" href="assets/css/tailwind.css">
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%233b82f6'%3E%3Cpath d='M20.57 14.86L22 13.43 20.57 12 17 15.57 8.43 7 12 3.43 10.57 2 9.14 3.43 7.71 2 5.57 4.14 4.14 2.71 2.71 4.14l1.43 1.43L2 7.71l1.43 1.43L2 10.57 3.43 12 7 8.43 15.57 17 12 20.57 13.43 22l1.43-1.43L16.29 22l2.14-2.14 1.43 1.43 1.43-1.43-1.43-1.43L22 16.29z'/%3E%3C/svg%3E">
</head>
<body class="bg-page">
  <!-- Skip to content link for accessibility -->
  <a href="#main-content" class="skip-link">Skip to main content</a>

  <!-- Password Modal -->
  <div id="password-modal" style="position:fixed;inset:0;background:rgba(0,0,0,0.8);z-index:9999;display:flex;align-items:center;justify-content:center;">
    <div class="card" style="max-width:400px;width:90%;margin:1rem;">
      <div class="card-body text-center">
        <div class="tool-card-icon mx-auto mb-4 bg-danger-100 text-danger-600" aria-hidden="true">üîí</div>
        <h2 class="text-xl font-bold mb-4" style="color: var(--text);">Admin Access Required</h2>
        <p class="mb-6" style="color: var(--text-muted);">Please enter the admin password to continue.</p>
        <form id="password-form" onsubmit="checkPassword(event)">
          <input type="password" id="admin-password" class="form-input mb-4" placeholder="Enter password" required aria-label="Admin password">
          <button type="submit" class="btn btn-primary w-full">Access Admin</button>
        </form>
        <p id="password-error" class="text-danger-500 text-sm mt-4" style="display:none;">Incorrect password. Please try again.</p>
      </div>
    </div>
  </div>

  <div class="site-wrapper" id="admin-content" style="display:none;">
    <!-- Sidebar Navigation (Desktop) -->
    <aside class="sidebar" id="sidebar" role="navigation" aria-label="Main navigation">
      <div class="sidebar-header">
        <a href="index.html" class="sidebar-logo">
          <svg class="sidebar-nav-icon" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M20.57 14.86L22 13.43 20.57 12 17 15.57 8.43 7 12 3.43 10.57 2 9.14 3.43 7.71 2 5.57 4.14 4.14 2.71 2.71 4.14l1.43 1.43L2 7.71l1.43 1.43L2 10.57 3.43 12 7 8.43 15.57 17 12 20.57 13.43 22l1.43-1.43L16.29 22l2.14-2.14 1.43 1.43 1.43-1.43-1.43-1.43L22 16.29z"/>
          </svg>
          <span>Iron & Ale</span>
        </a>
        <a href="README.md" class="sidebar-nav-item mt-2" target="_blank" style="display:block;color:#3b82f6;font-weight:500;">üìñ Project README</a>
      </div>
      
      <nav class="sidebar-nav">
        <a href="index.html" class="sidebar-nav-item">
          <svg class="sidebar-nav-icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
          </svg>
          <span>Home</span>
        </a>
        <a href="about/" class="sidebar-nav-item">
          <svg class="sidebar-nav-icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
          <span>About</span>
        </a>
        <a href="workouts/" class="sidebar-nav-item">
          <svg class="sidebar-nav-icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
          </svg>
          <span>Workouts</span>
        </a>
        <a href="utilities/" class="sidebar-nav-item">
          <svg class="sidebar-nav-icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
          </svg>
          <span>Utilities</span>
        </a>
        <a href="events.html" class="sidebar-nav-item">
          <svg class="sidebar-nav-icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
          </svg>
          <span>Events</span>
        </a>
        <a href="projects.html" class="sidebar-nav-item">
          <svg class="sidebar-nav-icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"/>
          </svg>
          <span>Projects</span>
        </a>
        <a href="admin.html" class="sidebar-nav-item active" aria-current="page">
        <a href="README.md" class="sidebar-nav-item" target="_blank">
          <svg class="sidebar-nav-icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="M8 17l4 4 4-4m-4-5v9"/>
          </svg>
          <span>Documentation</span>
        </a>
          <svg class="sidebar-nav-icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
          </svg>
          <span>Admin</span>
        </a>
      </nav>

      <div class="sidebar-footer">
        <p class="text-sm text-gray-400">&copy; <span id="sidebar-year">2024</span> Iron & Ale</p>
      </div>
    </aside>

    <!-- Overlay for mobile sidebar -->
    <div class="sidebar-overlay" id="sidebar-overlay" aria-hidden="true"></div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Mobile Header -->
      <header class="top-header">
        <a href="index.html" class="font-bold text-lg" style="color: var(--text);">Iron & Ale</a>
        <div class="flex items-center gap-2">
          <button class="theme-toggle" data-theme-toggle aria-label="Toggle dark mode" aria-pressed="false">
            <svg class="icon-sun" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>
            <svg class="icon-moon" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
          </button>
          <button class="mobile-menu-btn" id="mobile-menu-btn" aria-label="Open navigation menu" aria-expanded="false" aria-controls="sidebar">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"/>
            </svg>
          </button>
        </div>
      </header>

      <main id="main-content" role="main">
        <div class="page-container">
          <!-- Page Header -->
          <header class="page-header">
            <h1 class="page-title">Admin Tools</h1>
            <p class="page-subtitle">Webhook testing, URL validation, and site resources</p>
          </header>

          <!-- Quick Links Section -->
          <section class="mb-8" aria-labelledby="quick-links-title">
            <h2 id="quick-links-title" class="text-xl font-bold mb-6" style="color: var(--text);">Quick Links</h2>
            <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3">
              <a href="style-guide/" class="tool-card">
                <div class="tool-card-icon" aria-hidden="true">üé®</div>
                <h3 class="tool-card-title">Style Guide</h3>
                <p class="tool-card-desc">View the design system documentation, colors, typography, and components.</p>
              </a>
              <a href="pb-matrix.html" class="tool-card">
                <div class="tool-card-icon bg-success-100 text-success-600" aria-hidden="true">üìä</div>
                <h3 class="tool-card-title">PB Matrix</h3>
                <p class="tool-card-desc">View the Personal Bests Matrix for all community members.</p>
              </a>
              <a href="utilities/" class="tool-card">
                <div class="tool-card-icon bg-secondary-100 text-secondary-600" aria-hidden="true">üîß</div>
                <h3 class="tool-card-title">Utilities</h3>
                <p class="tool-card-desc">Access calculators, timers, and tracking tools.</p>
              </a>
              <a href="events/README.md" class="tool-card" target="_blank">
                <div class="tool-card-icon bg-primary-100 text-primary-600" aria-hidden="true">üìÖ</div>
                <h3 class="tool-card-title">Events Guide</h3>
                <p class="tool-card-desc">Complete guide for adding events manually or via n8n automation.</p>
              </a>
            </div>
          </section>

          <!-- AI Agents Section -->
          <section class="mb-8" aria-labelledby="ai-agents-title">
            <h2 id="ai-agents-title" class="text-xl font-bold mb-6" style="color: var(--text);">AI Agents</h2>
            <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3">
              <a href="docs/workflows/enrichment-agent.md" class="tool-card" target="_blank" rel="noopener">
                <div class="tool-card-icon bg-primary-100 text-primary-600" aria-hidden="true">üß†</div>
                <h3 class="tool-card-title">Enrichment Agent</h3>
                <p class="tool-card-desc">AI-assisted workflow for enriching workout metadata with consistent structure.</p>
              </a>

              <a href="docs/workout-youtube-agent.md" class="tool-card" target="_blank" rel="noopener">
                <div class="tool-card-icon bg-secondary-100 text-secondary-600" aria-hidden="true">üé•</div>
                <h3 class="tool-card-title">YouTube Workout Agent</h3>
                <p class="tool-card-desc">n8n agent for sourcing Shorts-ready workout videos that match workout specs.</p>
              </a>
            </div>
          </section>

          <!-- Webhook Test Section -->
          <section class="mb-8" aria-labelledby="webhook-test-title">
            <h2 id="webhook-test-title" class="text-xl font-bold mb-6" style="color: var(--text);">Webhook Test</h2>
            <div class="card">
              <div class="card-body">
                <p class="mb-6" style="color: var(--text-muted);">Send a test workout log to the webhook endpoint. Toggle between strength and cardio modes.</p>
                
                <!-- Mode Toggle -->
                <div class="mb-6">
                  <label class="form-label">Workout Type</label>
                  <div class="flex gap-4">
                    <label class="inline-flex items-center">
                      <input type="radio" name="test-mode" value="strength" checked onchange="toggleTestMode()" class="mr-2">
                      <span>Strength</span>
                    </label>
                    <label class="inline-flex items-center">
                      <input type="radio" name="test-mode" value="cardio" onchange="toggleTestMode()" class="mr-2">
                      <span>Cardio</span>
                    </label>
                  </div>
                </div>

                <form id="webhook-test-form" class="grid grid-cols-1 gap-4 md:grid-cols-2">
                  <div>
                    <label for="test-name" class="form-label">Name</label>
                    <input type="text" id="test-name" class="form-input" placeholder="Name" required value="Test User">
                  </div>
                  <div>
                    <label for="test-exercise" class="form-label">Exercise</label>
                    <select id="test-exercise" class="form-select" required>
                      <optgroup label="Compound Lifts">
                        <option value="bench-press" selected>Bench Press</option>
                        <option value="incline-bench">Incline Bench Press</option>
                        <option value="back-squat">Back Squat</option>
                        <option value="front-squat">Front Squat</option>
                        <option value="deadlift">Deadlift</option>
                        <option value="romanian-deadlift">Romanian Deadlift</option>
                        <option value="overhead-press">Overhead Press</option>
                        <option value="barbell-row">Barbell Row</option>
                      </optgroup>
                      <optgroup label="Olympic Lifts">
                        <option value="clean-and-jerk">Clean & Jerk</option>
                        <option value="snatch">Snatch</option>
                        <option value="power-clean">Power Clean</option>
                      </optgroup>
                      <optgroup label="Accessories">
                        <option value="pullups">Pull-ups/Chin-ups</option>
                        <option value="dips">Dips</option>
                        <option value="bicep-curl">Bicep Curl</option>
                        <option value="tricep-extension">Tricep Extension</option>
                        <option value="lunges">Lunges</option>
                        <option value="hip-thrust">Hip Thrust</option>
                      </optgroup>
                      <optgroup label="Cardio">
                        <option value="row-erg">Row Erg</option>
                        <option value="ski-erg">Ski Erg</option>
                        <option value="bike-erg">Bike Erg</option>
                        <option value="running">Running</option>
                      </optgroup>
                    </select>
                  </div>
                  <div>
                    <label for="test-date" class="form-label">Date</label>
                    <input type="date" id="test-date" class="form-input" required>
                  </div>
                  
                  <!-- Strength Fields -->
                  <div id="test-strength-sets">
                    <label for="test-sets" class="form-label">Sets</label>
                    <input type="number" id="test-sets" class="form-input" placeholder="Sets" min="1" value="3">
                  </div>
                  <div id="test-strength-reps">
                    <label for="test-reps" class="form-label">Reps</label>
                    <input type="number" id="test-reps" class="form-input" placeholder="Reps" min="1" value="10">
                  </div>
                  <div id="test-strength-weight">
                    <label for="test-weight" class="form-label">Weight (kg)</label>
                    <input type="number" id="test-weight" class="form-input" placeholder="Weight" min="0" value="60">
                  </div>
                  
                  <!-- Cardio Fields (hidden by default) -->
                  <div id="test-cardio-time" style="display:none;">
                    <label for="test-time" class="form-label">Time (minutes)</label>
                    <input type="number" id="test-time" class="form-input" placeholder="Time" min="0" step="0.1" value="30">
                  </div>
                  <div id="test-cardio-distance" style="display:none;">
                    <label for="test-distance" class="form-label">Distance (km)</label>
                    <input type="number" id="test-distance" class="form-input" placeholder="Distance" min="0" step="0.01" value="5">
                  </div>
                  
                  <div>
                    <label for="test-pr" class="form-label">Personal Record</label>
                    <select id="test-pr" class="form-select">
                      <option value="NO" selected>NO</option>
                      <option value="YES">YES</option>
                    </select>
                  </div>
                  <div class="md:col-span-2">
                    <label for="test-notes" class="form-label">Notes</label>
                    <textarea id="test-notes" class="form-input" placeholder="Notes" rows="2">Sample test data for webhook</textarea>
                  </div>
                  <div class="md:col-span-2">
                    <button type="button" class="btn btn-primary" onclick="sendWebhookTest()">
                      <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
                      </svg>
                      Send Test to Webhook
                    </button>
                  </div>
                </form>
                <div id="webhook-test-result" class="mt-4 text-center font-semibold" role="status" aria-live="polite"></div>
                <div id="webhook-test-log" class="mt-4 p-4 rounded-lg text-danger-600 font-mono text-sm" style="background: var(--bg-alt); display:none;" role="alert"></div>
              </div>
            </div>
          </section>

          <!-- PB Matrix URL Test Section -->
          <section class="mb-8" aria-labelledby="pb-url-test-title">
            <h2 id="pb-url-test-title" class="text-xl font-bold mb-6" style="color: var(--text);">PB Matrix URL Test</h2>
            <div class="card">
              <div class="card-body">
                <p class="mb-6" style="color: var(--text-muted);">Test the Google Apps Script URL for the Personal Bests Matrix.</p>
                <div class="flex flex-col gap-4">
                  <div>
                    <label for="pb-url-test" class="form-label">PB Matrix URL</label>
                    <input type="text" id="pb-url-test" class="form-input" placeholder="Enter PB Matrix URL" 
                      value="https://script.google.com/macros/s/AKfycbzFslB8yDXO8G9ClvbFZX5q8URyvVSQa7R6mfnWpl2a7Cy4gxIRugOzkO4t4o7WlX_jOw/exec">
                  </div>
                  <button type="button" class="btn btn-secondary" onclick="testPBMatrixUrl()">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    Test PB Matrix URL
                  </button>
                </div>
                <div id="pb-url-test-result" class="mt-4 text-center font-semibold" role="status" aria-live="polite"></div>
                <div id="pb-url-test-data" class="mt-4 p-4 rounded-lg overflow-auto" style="background: var(--bg-alt); display:none;max-height:200px;">
                  <pre id="pb-url-test-json" class="text-success-600 font-mono text-sm" style="white-space:pre-wrap;word-break:break-all;margin:0;"></pre>
                </div>
              </div>
            </div>
          </section>

          <!-- Event Submission Section -->
          <section class="mb-8" aria-labelledby="event-submission-title">
            <h2 id="event-submission-title" class="text-xl font-bold mb-6" style="color: var(--text);">Add New Event</h2>
            <div class="card">
              <div class="card-body">
                <p class="mb-6" style="color: var(--text-muted);">Submit a new event to be processed via the n8n webhook. The event will be enriched with AI-generated content and added to the events page.</p>
                
                <form id="event-form" class="grid grid-cols-1 gap-4 md:grid-cols-2">
                  <!-- Basic Event Info -->
                  <div class="md:col-span-2">
                    <h3 class="text-lg font-semibold mb-4" style="color: var(--text);">Event Details</h3>
                  </div>
                  <div>
                    <label for="event-name" class="form-label">Event Name *</label>
                    <input type="text" id="event-name" class="form-input" placeholder="e.g., Nuclear Fit Summer" required oninput="updateEventFilename()">
                  </div>
                  <div>
                    <label for="event-date" class="form-label">Date & Time *</label>
                    <input type="datetime-local" id="event-date" class="form-input" required oninput="updateEventFilename()">
                  </div>
                  <div class="md:col-span-2">
                    <label for="event-filename" class="form-label">Generated Filename</label>
                    <input type="text" id="event-filename" class="form-input" placeholder="Auto-generated from name and date" readonly style="background: var(--bg-alt); color: var(--text-muted);">
                    <p class="text-sm mt-1" style="color: var(--text-muted);">This filename is auto-generated and will be used by n8n.</p>
                  </div>
                  <div>
                    <label for="event-link" class="form-label">Event Link (URL)</label>
                    <input type="url" id="event-link" class="form-input" placeholder="https://example.com/event">
                  </div>
                  <div>
                    <label for="event-image" class="form-label">Image Path</label>
                    <input type="text" id="event-image" class="form-input" placeholder="images/event.jpg or leave blank for AI">
                  </div>
                  <div class="md:col-span-2">
                    <label for="event-description" class="form-label">Description</label>
                    <textarea id="event-description" class="form-input" placeholder="Short description (leave blank for AI-generated)" rows="2"></textarea>
                    <button type="button" class="btn btn-secondary mt-4 w-full" onclick="loadTestEventData()">Load Test Event Data</button>
                  </div>
                  
                  <!-- Calendar Details -->
                  <div class="md:col-span-2 mt-4">
                    <h3 class="text-lg font-semibold mb-4" style="color: var(--text);">Calendar Details</h3>
                  </div>
                  <div>
                    <label for="event-location" class="form-label">Location *</label>
                    <input type="text" id="event-location" class="form-input" placeholder="e.g., London, UK" required>
                  </div>
                  <div>
                    <label for="event-duration" class="form-label">Duration (hours) *</label>
                    <input type="number" id="event-duration" class="form-input" placeholder="4" min="1" max="72" value="4" required>
                  </div>
                  <div class="md:col-span-2">
                    <label for="event-calendar-desc" class="form-label">Calendar Description</label>
                    <textarea id="event-calendar-desc" class="form-input" placeholder="Description for calendar file (leave blank for AI-generated)" rows="2"></textarea>
                  </div>
                  
                  <!-- Display Options -->
                  <div class="md:col-span-2 mt-4">
                    <h3 class="text-lg font-semibold mb-4" style="color: var(--text);">Display Options</h3>
                  </div>
                  <div class="flex items-center gap-4">
                    <label class="inline-flex items-center">
                      <input type="checkbox" id="event-show-more-info" class="mr-2" checked>
                      <span>Show More Info</span>
                    </label>
                    <label class="inline-flex items-center">
                      <input type="checkbox" id="event-show-book-now" class="mr-2">
                      <span>Show Book Now</span>
                    </label>
                    <label class="inline-flex items-center">
                      <input type="checkbox" id="event-show-remind-me" class="mr-2" checked>
                      <span>Show Remind Me</span>
                    </label>
                  </div>
                  
                  <!-- Submit Button -->
                  <div class="md:col-span-2 mt-4">
                    <button type="button" class="btn btn-primary" onclick="submitEvent()">
                      <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/>
                      </svg>
                      Submit Event to Webhook
                    </button>
                  </div>
                </form>
                <div id="event-submit-result" class="mt-4 text-center font-semibold" role="status" aria-live="polite"></div>
                <div id="event-submit-log" class="mt-4 p-4 rounded-lg text-success-600 font-mono text-sm" style="background: var(--bg-alt); display:none;"></div>
              </div>
            </div>
          </section>

          <!-- Contact Section -->
          <section aria-labelledby="contact-title">
            <h2 id="contact-title" class="text-xl font-bold mb-6" style="color: var(--text);">Contact</h2>
            <div class="card">
              <div class="card-body">
                <p class="mb-4" style="color: var(--text-muted);">For admin support or questions, contact:</p>
                <a href="mailto:email@petefox.co.uk" class="btn btn-primary">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                  </svg>
                  email@petefox.co.uk
                </a>
              </div>
            </div>
          </section>
        </div>

        <!-- Footer -->
        <footer class="bg-gray-900 text-white py-8 px-6 mt-12" role="contentinfo">
          <div class="max-w-6xl mx-auto text-center">
            <p class="text-sm text-gray-400">
              &copy; <span id="footer-year">2024</span> Iron & Ale. All rights reserved.
            </p>
          </div>
        </footer>
      </main>
    </div>
  </div>

  <script src="assets/js/theme.js"></script>
  <script src="assets/js/app.js"></script>
  <script>
        // Prepopulate Add New Event form for testing
        function loadTestEventData() {
          document.getElementById('event-name').value = 'Spring Marathon';
          document.getElementById('event-date').value = '2026-03-15T09:00';
          document.getElementById('event-link').value = 'https://springmarathon.com';
          document.getElementById('event-image').value = 'images/spring-marathon.jpg';
          document.getElementById('event-description').value = 'üèÉ Join us for the annual Spring Marathon! A challenging but rewarding run through scenic countryside.';
          document.getElementById('event-location').value = 'Central Park, London';
          document.getElementById('event-calendar-desc').value = 'Spring Marathon 2026 - 26.2 miles of adventure';
          document.getElementById('event-duration').value = '6';
          document.getElementById('show-more-info').checked = true;
          document.getElementById('show-book-now').checked = true;
          document.getElementById('show-remind-me').checked = true;
          updateEventFilename();
        }
    // Set current year
    const currentYear = new Date().getFullYear();
    document.getElementById('footer-year').textContent = currentYear;
    document.getElementById('sidebar-year').textContent = currentYear;
    
    // Set today's date as default
    document.getElementById('test-date').value = new Date().toISOString().split('T')[0];

    // Webhook endpoints
    const WEBHOOK_WORKOUT_LOG = 'https://n8n.petefox.co.uk/webhook/workout-log';
    const WEBHOOK_EVENTS = 'https://n8n.petefox.co.uk/webhook/events';

    // Cardio exercises list
    const CARDIO_EXERCISES = ['row-erg', 'ski-erg', 'bike-erg', 'running'];

    // Generate UUID
    function generateUUID() {
      if (typeof crypto !== 'undefined' && crypto.randomUUID) {
        return crypto.randomUUID();
      }
      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
        const r = Math.random() * 16 | 0;
        const v = c === 'x' ? r : (r & 0x3 | 0x8);
        return v.toString(16);
      });
    }

    // Toggle test mode between strength and cardio
    function toggleTestMode() {
      const isCardio = document.querySelector('input[name="test-mode"]:checked').value === 'cardio';
      
      // Show/hide strength fields
      document.getElementById('test-strength-sets').style.display = isCardio ? 'none' : '';
      document.getElementById('test-strength-reps').style.display = isCardio ? 'none' : '';
      document.getElementById('test-strength-weight').style.display = isCardio ? 'none' : '';
      
      // Show/hide cardio fields
      document.getElementById('test-cardio-time').style.display = isCardio ? '' : 'none';
      document.getElementById('test-cardio-distance').style.display = isCardio ? '' : 'none';
      
      // Update exercise dropdown to match mode
      const exerciseSelect = document.getElementById('test-exercise');
      if (isCardio) {
        exerciseSelect.value = 'row-erg';
      } else {
        exerciseSelect.value = 'bench-press';
      }
    }

    // Generate event filename from name and date
    function generateEventFilename(name, dateValue) {
      if (!name || !dateValue) return '';
      
      // Convert name to lowercase, replace non-alphanumeric chars with hyphens, trim leading/trailing hyphens
      const eventName = name.toLowerCase()
        .replace(/[^a-z0-9]+/g, '-')
        .replace(/^-|-$/g, '');
      
      // Extract YYYYMMDD from datetime-local format (YYYY-MM-DDTHH:mm)
      const eventDate = dateValue.substring(0, 10).replace(/-/g, '');
      
      return `${eventName}-${eventDate}.json`;
    }

    // Update filename field when name or date changes
    function updateEventFilename() {
      const name = document.getElementById('event-name').value.trim();
      const dateValue = document.getElementById('event-date').value;
      const filenameInput = document.getElementById('event-filename');
      
      const filename = generateEventFilename(name, dateValue);
      filenameInput.value = filename;
    }

    // Password protection
    const ADMIN_PASSWORD = 'ironale2024';
    
    function checkPassword(event) {
      event.preventDefault();
      const password = document.getElementById('admin-password').value;
      const errorMsg = document.getElementById('password-error');
      
      if (password === ADMIN_PASSWORD) {
        document.getElementById('password-modal').style.display = 'none';
        document.getElementById('admin-content').style.display = '';
        sessionStorage.setItem('adminAuth', 'true');
      } else {
        errorMsg.style.display = 'block';
        document.getElementById('admin-password').value = '';
        document.getElementById('admin-password').focus();
      }
    }
    
    // Check if already authenticated
    if (sessionStorage.getItem('adminAuth') === 'true') {
      document.getElementById('password-modal').style.display = 'none';
      document.getElementById('admin-content').style.display = '';
    }

    function sendWebhookTest() {
      const result = document.getElementById('webhook-test-result');
      const log = document.getElementById('webhook-test-log');
      result.textContent = '';
      result.className = 'mt-4 text-center font-semibold';
      log.style.display = 'none';
      log.textContent = '';
      
      const isCardio = document.querySelector('input[name="test-mode"]:checked').value === 'cardio';
      const exerciseSelect = document.getElementById('test-exercise');
      
      const data = {
        id: generateUUID(),
        name: document.getElementById('test-name').value,
        exercise: exerciseSelect.value,
        exerciseName: exerciseSelect.options[exerciseSelect.selectedIndex].text,
        date: document.getElementById('test-date').value,
        sets: isCardio ? null : parseInt(document.getElementById('test-sets').value),
        reps: isCardio ? null : parseInt(document.getElementById('test-reps').value),
        weight: isCardio ? null : parseFloat(document.getElementById('test-weight').value) || 0,
        unit: 'kg',
        time: isCardio ? parseFloat(document.getElementById('test-time').value) || 0 : null,
        distance: isCardio ? parseFloat(document.getElementById('test-distance').value) || 0 : null,
        notes: document.getElementById('test-notes').value,
        pr: document.getElementById('test-pr').value
      };
      
      result.textContent = '‚è≥ Sending...';
      result.className = 'mt-4 text-center font-semibold text-primary-600';
      
      fetch(WEBHOOK_WORKOUT_LOG, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      })
      .then(res => {
        if (!res.ok) {
          log.style.display = 'block';
          log.textContent = 'HTTP Error: ' + res.status + ' ' + res.statusText;
          throw new Error('HTTP Error: ' + res.status);
        }
        return res.text();
      })
      .then(text => {
        result.textContent = '‚úÖ Webhook sent! Response: ' + text;
        result.className = 'mt-4 text-center font-semibold text-success-600';
        log.style.display = 'block';
        log.className = 'mt-4 p-4 bg-gray-100 rounded-lg text-success-600 font-mono text-sm';
        log.textContent = 'Payload sent:\n' + JSON.stringify(data, null, 2);
      })
      .catch(err => {
        log.style.display = 'block';
        log.className = 'mt-4 p-4 bg-gray-100 rounded-lg text-danger-600 font-mono text-sm';
        log.textContent += '\n' + (err.message || err);
        result.textContent = '‚ùå Error sending webhook.';
        result.className = 'mt-4 text-center font-semibold text-danger-600';
      });
    }

    function testPBMatrixUrl() {
      const urlInput = document.getElementById('pb-url-test');
      const result = document.getElementById('pb-url-test-result');
      const dataDiv = document.getElementById('pb-url-test-data');
      const jsonPre = document.getElementById('pb-url-test-json');
      
      const url = urlInput.value.trim();
      
      if (!url) {
        result.textContent = 'Please enter a URL';
        result.className = 'mt-4 text-center font-semibold text-danger-600';
        return;
      }
      
      // Show loading state
      result.textContent = '‚è≥ Testing URL...';
      result.className = 'mt-4 text-center font-semibold text-primary-600';
      dataDiv.style.display = 'none';
      
      // Add format=json parameter
      const jsonUrl = url + (url.includes('?') ? '&' : '?') + 'format=json';
      
      fetch(jsonUrl)
        .then(response => {
          if (!response.ok) {
            throw new Error('HTTP Error: ' + response.status + ' ' + response.statusText);
          }
          return response.json();
        })
        .then(data => {
          result.textContent = '‚úÖ URL is working! Found ' + (data.rows ? data.rows.length : 0) + ' members and ' + (data.exercises ? data.exercises.length : 0) + ' exercises.';
          result.className = 'mt-4 text-center font-semibold text-success-600';
          dataDiv.style.display = 'block';
          jsonPre.textContent = JSON.stringify(data, null, 2);
        })
        .catch(error => {
          result.textContent = '‚ùå Error: ' + error.message;
          result.className = 'mt-4 text-center font-semibold text-danger-600';
          dataDiv.style.display = 'none';
        });
    }

    // Submit event to n8n webhook
    function submitEvent() {
      const result = document.getElementById('event-submit-result');
      const log = document.getElementById('event-submit-log');
      result.textContent = '';
      result.className = 'mt-4 text-center font-semibold';
      log.style.display = 'none';
      log.textContent = '';
      
      // Validate required fields
      const name = document.getElementById('event-name').value.trim();
      const dateValue = document.getElementById('event-date').value;
      const location = document.getElementById('event-location').value.trim();
      const duration = parseInt(document.getElementById('event-duration').value) || 4;
      
      if (!name || !dateValue || !location) {
        result.textContent = '‚ùå Please fill in all required fields (Name, Date, Location).';
        result.className = 'mt-4 text-center font-semibold text-danger-600';
        return;
      }
      
      // Generate filename for n8n
      const filename = generateEventFilename(name, dateValue);
      if (!filename) {
        result.textContent = '‚ùå Could not generate filename. Please check name and date.';
        result.className = 'mt-4 text-center font-semibold text-danger-600';
        return;
      }
      
      // Format date to ISO 8601 local time (YYYY-MM-DDTHH:mm:ss)
      // Remove milliseconds and Z suffix to match existing event JSON schema
      const dateObj = new Date(dateValue);
      const isoDate = dateObj.toISOString().replace(/\.\d{3}Z$/, '');
      
      // Build event data with filename for n8n
      const eventData = {
        filename: filename,
        name: name,
        date: isoDate,
        link: document.getElementById('event-link').value.trim() || null,
        image: document.getElementById('event-image').value.trim() || null,
        description: document.getElementById('event-description').value.trim() || null,
        calendarDetails: {
          location: location,
          description: document.getElementById('event-calendar-desc').value.trim() || null,
          durationHours: duration
        },
        showMoreInfo: document.getElementById('event-show-more-info').checked,
        showBookNow: document.getElementById('event-show-book-now').checked,
        showRemindMe: document.getElementById('event-show-remind-me').checked
      };
      
      result.textContent = '‚è≥ Submitting event...';
      result.className = 'mt-4 text-center font-semibold text-primary-600';
      
      fetch(WEBHOOK_EVENTS, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(eventData)
      })
      .then(res => {
        if (!res.ok) {
          log.style.display = 'block';
          log.className = 'mt-4 p-4 bg-gray-100 rounded-lg text-danger-600 font-mono text-sm';
          log.textContent = 'HTTP Error: ' + res.status + ' ' + res.statusText;
          throw new Error('HTTP Error: ' + res.status);
        }
        return res.text();
      })
      .then(text => {
        result.textContent = '‚úÖ Event submitted! Response: ' + text;
        result.className = 'mt-4 text-center font-semibold text-success-600';
        log.style.display = 'block';
        log.className = 'mt-4 p-4 bg-gray-100 rounded-lg text-success-600 font-mono text-sm';
        log.textContent = 'Event data sent:\n' + JSON.stringify(eventData, null, 2);
        
        // Clear form on success
        document.getElementById('event-form').reset();
        document.getElementById('event-show-more-info').checked = true;
        document.getElementById('event-show-remind-me').checked = true;
        document.getElementById('event-duration').value = '4';
      })
      .catch(err => {
        log.style.display = 'block';
        log.className = 'mt-4 p-4 bg-gray-100 rounded-lg text-danger-600 font-mono text-sm';
        if (!log.textContent) {
          log.textContent = err.message || err;
        }
        result.textContent = '‚ùå Error submitting event.';
        result.className = 'mt-4 text-center font-semibold text-danger-600';
      });
    }
  </script>
</body>
</html>
