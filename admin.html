<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin | Iron & Ale</title>
  <meta name="description" content="Iron & Ale admin tools - Webhook testing and PB Matrix URL validation.">
  <link rel="stylesheet" href="assets/css/tailwind.css">
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%233b82f6'%3E%3Cpath d='M20.57 14.86L22 13.43 20.57 12 17 15.57 8.43 7 12 3.43 10.57 2 9.14 3.43 7.71 2 5.57 4.14 4.14 2.71 2.71 4.14l1.43 1.43L2 7.71l1.43 1.43L2 10.57 3.43 12 7 8.43 15.57 17 12 20.57 13.43 22l1.43-1.43L16.29 22l2.14-2.14 1.43 1.43 1.43-1.43-1.43-1.43L22 16.29z'/%3E%3C/svg%3E">
</head>
<body class="bg-gray-50">
  <!-- Skip to content link for accessibility -->
  <a href="#main-content" class="skip-link">Skip to main content</a>

  <!-- Password Modal -->
  <div id="password-modal" style="position:fixed;inset:0;background:rgba(0,0,0,0.8);z-index:9999;display:flex;align-items:center;justify-content:center;">
    <div class="card" style="max-width:400px;width:90%;margin:1rem;">
      <div class="card-body text-center">
        <div class="tool-card-icon mx-auto mb-4 bg-danger-100 text-danger-600" aria-hidden="true">üîí</div>
        <h2 class="text-xl font-bold text-gray-900 mb-4">Admin Access Required</h2>
        <p class="text-gray-500 mb-6">Please enter the admin password to continue.</p>
        <form id="password-form" onsubmit="checkPassword(event)">
          <input type="password" id="admin-password" class="form-input mb-4" placeholder="Enter password" required aria-label="Admin password">
          <button type="submit" class="btn btn-primary w-full">Access Admin</button>
        </form>
        <p id="password-error" class="text-danger-500 text-sm mt-4" style="display:none;">Incorrect password. Please try again.</p>
      </div>
    </div>
  </div>

  <div class="site-wrapper" id="admin-content" style="display:none;">
    <!-- Sidebar Navigation (Desktop) -->
    <aside class="sidebar" id="sidebar" role="navigation" aria-label="Main navigation">
      <div class="sidebar-header">
        <a href="index.html" class="sidebar-logo">
          <svg class="sidebar-nav-icon" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M20.57 14.86L22 13.43 20.57 12 17 15.57 8.43 7 12 3.43 10.57 2 9.14 3.43 7.71 2 5.57 4.14 4.14 2.71 2.71 4.14l1.43 1.43L2 7.71l1.43 1.43L2 10.57 3.43 12 7 8.43 15.57 17 12 20.57 13.43 22l1.43-1.43L16.29 22l2.14-2.14 1.43 1.43 1.43-1.43-1.43-1.43L22 16.29z"/>
          </svg>
          <span>Iron & Ale</span>
        </a>
      </div>
      
      <nav class="sidebar-nav">
        <a href="index.html" class="sidebar-nav-item">
          <svg class="sidebar-nav-icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
          </svg>
          <span>Home</span>
        </a>
        <a href="about/" class="sidebar-nav-item">
          <svg class="sidebar-nav-icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
          <span>About</span>
        </a>
        <a href="utilities/" class="sidebar-nav-item">
          <svg class="sidebar-nav-icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
          </svg>
          <span>Utilities</span>
        </a>
        <a href="events.html" class="sidebar-nav-item">
          <svg class="sidebar-nav-icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
          </svg>
          <span>Events</span>
        </a>
        <a href="projects.html" class="sidebar-nav-item">
          <svg class="sidebar-nav-icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"/>
          </svg>
          <span>Projects</span>
        </a>
        <a href="style-guide/" class="sidebar-nav-item">
          <svg class="sidebar-nav-icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"/>
          </svg>
          <span>Style Guide</span>
        </a>
        <a href="admin.html" class="sidebar-nav-item active" aria-current="page">
          <svg class="sidebar-nav-icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
          </svg>
          <span>Admin</span>
        </a>
      </nav>

      <div class="sidebar-footer">
        <p class="text-sm text-gray-400">&copy; <span id="sidebar-year">2024</span> Iron & Ale</p>
      </div>
    </aside>

    <!-- Overlay for mobile sidebar -->
    <div class="sidebar-overlay" id="sidebar-overlay" aria-hidden="true"></div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Mobile Header -->
      <header class="top-header">
        <a href="index.html" class="font-bold text-lg text-gray-900">Iron & Ale</a>
        <button class="mobile-menu-btn" id="mobile-menu-btn" aria-label="Open navigation menu" aria-expanded="false" aria-controls="sidebar">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"/>
          </svg>
        </button>
      </header>

      <main id="main-content" role="main">
        <div class="page-container">
          <!-- Page Header -->
          <header class="page-header">
            <h1 class="page-title">Admin Tools</h1>
            <p class="page-subtitle">Webhook testing, URL validation, and site resources</p>
          </header>

          <!-- Quick Links Section -->
          <section class="mb-8" aria-labelledby="quick-links-title">
            <h2 id="quick-links-title" class="text-xl font-bold text-gray-900 mb-6">Quick Links</h2>
            <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3">
              <a href="style-guide/" class="tool-card">
                <div class="tool-card-icon" aria-hidden="true">üé®</div>
                <h3 class="tool-card-title">Style Guide</h3>
                <p class="tool-card-desc">View the design system documentation, colors, typography, and components.</p>
              </a>
              <a href="pb-matrix.html" class="tool-card">
                <div class="tool-card-icon bg-success-100 text-success-600" aria-hidden="true">üìä</div>
                <h3 class="tool-card-title">PB Matrix</h3>
                <p class="tool-card-desc">View the Personal Bests Matrix for all community members.</p>
              </a>
              <a href="utilities/" class="tool-card">
                <div class="tool-card-icon bg-secondary-100 text-secondary-600" aria-hidden="true">üîß</div>
                <h3 class="tool-card-title">Utilities</h3>
                <p class="tool-card-desc">Access calculators, timers, and tracking tools.</p>
              </a>
            </div>
          </section>

          <!-- Webhook Test Section -->
          <section class="mb-8" aria-labelledby="webhook-test-title">
            <h2 id="webhook-test-title" class="text-xl font-bold text-gray-900 mb-6">Webhook Test</h2>
            <div class="card">
              <div class="card-body">
                <p class="text-gray-500 mb-6">Send a test workout log to the webhook endpoint.</p>
                <form id="webhook-test-form" class="grid grid-cols-1 gap-4 md:grid-cols-2">
                  <div>
                    <label for="test-name" class="form-label">Name</label>
                    <input type="text" id="test-name" class="form-input" placeholder="Name" required value="Test User">
                  </div>
                  <div>
                    <label for="test-exercise" class="form-label">Exercise</label>
                    <input type="text" id="test-exercise" class="form-input" placeholder="Exercise" required value="Bench Press">
                  </div>
                  <div>
                    <label for="test-date" class="form-label">Date</label>
                    <input type="date" id="test-date" class="form-input" required>
                  </div>
                  <div>
                    <label for="test-sets" class="form-label">Sets</label>
                    <input type="number" id="test-sets" class="form-input" placeholder="Sets" min="1" required value="3">
                  </div>
                  <div>
                    <label for="test-reps" class="form-label">Reps</label>
                    <input type="number" id="test-reps" class="form-input" placeholder="Reps" min="1" required value="10">
                  </div>
                  <div>
                    <label for="test-weight" class="form-label">Weight (kg)</label>
                    <input type="number" id="test-weight" class="form-input" placeholder="Weight" min="0" required value="60">
                  </div>
                  <div class="md:col-span-2">
                    <label for="test-notes" class="form-label">Notes</label>
                    <textarea id="test-notes" class="form-input" placeholder="Notes" rows="2">Sample test data for webhook</textarea>
                  </div>
                  <div class="md:col-span-2">
                    <button type="button" class="btn btn-primary" onclick="sendWebhookTest()">
                      <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
                      </svg>
                      Send Test to Webhook
                    </button>
                  </div>
                </form>
                <div id="webhook-test-result" class="mt-4 text-center font-semibold" role="status" aria-live="polite"></div>
                <div id="webhook-test-log" class="mt-4 p-4 bg-gray-100 rounded-lg text-danger-600 font-mono text-sm" style="display:none;" role="alert"></div>
              </div>
            </div>
          </section>

          <!-- PB Matrix URL Test Section -->
          <section class="mb-8" aria-labelledby="pb-url-test-title">
            <h2 id="pb-url-test-title" class="text-xl font-bold text-gray-900 mb-6">PB Matrix URL Test</h2>
            <div class="card">
              <div class="card-body">
                <p class="text-gray-500 mb-6">Test the Google Apps Script URL for the Personal Bests Matrix.</p>
                <div class="flex flex-col gap-4">
                  <div>
                    <label for="pb-url-test" class="form-label">PB Matrix URL</label>
                    <input type="text" id="pb-url-test" class="form-input" placeholder="Enter PB Matrix URL" 
                      value="https://script.google.com/macros/s/AKfycbzFslB8yDXO8G9ClvbFZX5q8URyvVSQa7R6mfnWpl2a7Cy4gxIRugOzkO4t4o7WlX_jOw/exec">
                  </div>
                  <button type="button" class="btn btn-secondary" onclick="testPBMatrixUrl()">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    Test PB Matrix URL
                  </button>
                </div>
                <div id="pb-url-test-result" class="mt-4 text-center font-semibold" role="status" aria-live="polite"></div>
                <div id="pb-url-test-data" class="mt-4 p-4 bg-gray-100 rounded-lg overflow-auto" style="display:none;max-height:200px;">
                  <pre id="pb-url-test-json" class="text-success-600 font-mono text-sm" style="white-space:pre-wrap;word-break:break-all;margin:0;"></pre>
                </div>
              </div>
            </div>
          </section>

          <!-- Contact Section -->
          <section aria-labelledby="contact-title">
            <h2 id="contact-title" class="text-xl font-bold text-gray-900 mb-6">Contact</h2>
            <div class="card">
              <div class="card-body">
                <p class="text-gray-500 mb-4">For admin support or questions, contact:</p>
                <a href="mailto:email@petefox.co.uk" class="btn btn-primary">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                  </svg>
                  email@petefox.co.uk
                </a>
              </div>
            </div>
          </section>
        </div>

        <!-- Footer -->
        <footer class="bg-gray-900 text-white py-8 px-6 mt-12" role="contentinfo">
          <div class="max-w-6xl mx-auto text-center">
            <p class="text-sm text-gray-400">
              &copy; <span id="footer-year">2024</span> Iron & Ale. All rights reserved.
            </p>
          </div>
        </footer>
      </main>
    </div>
  </div>

  <script src="assets/js/app.js"></script>
  <script>
    // Set current year
    const currentYear = new Date().getFullYear();
    document.getElementById('footer-year').textContent = currentYear;
    document.getElementById('sidebar-year').textContent = currentYear;
    
    // Set today's date as default
    document.getElementById('test-date').value = new Date().toISOString().split('T')[0];

    // Password protection
    const ADMIN_PASSWORD = 'ironale2024';
    
    function checkPassword(event) {
      event.preventDefault();
      const password = document.getElementById('admin-password').value;
      const errorMsg = document.getElementById('password-error');
      
      if (password === ADMIN_PASSWORD) {
        document.getElementById('password-modal').style.display = 'none';
        document.getElementById('admin-content').style.display = '';
        sessionStorage.setItem('adminAuth', 'true');
      } else {
        errorMsg.style.display = 'block';
        document.getElementById('admin-password').value = '';
        document.getElementById('admin-password').focus();
      }
    }
    
    // Check if already authenticated
    if (sessionStorage.getItem('adminAuth') === 'true') {
      document.getElementById('password-modal').style.display = 'none';
      document.getElementById('admin-content').style.display = '';
    }

    function sendWebhookTest() {
      const result = document.getElementById('webhook-test-result');
      const log = document.getElementById('webhook-test-log');
      result.textContent = '';
      result.className = 'mt-4 text-center font-semibold';
      log.style.display = 'none';
      log.textContent = '';
      const data = {
        name: document.getElementById('test-name').value,
        exercise: document.getElementById('test-exercise').value,
        date: document.getElementById('test-date').value,
        sets: document.getElementById('test-sets').value,
        reps: document.getElementById('test-reps').value,
        weight: document.getElementById('test-weight').value,
        notes: document.getElementById('test-notes').value
      };
      
      result.textContent = '‚è≥ Sending...';
      result.className = 'mt-4 text-center font-semibold text-primary-600';
      
      fetch('https://n8n.petefox.co.uk/webhook/workout-log', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      })
      .then(res => {
        if (!res.ok) {
          log.style.display = 'block';
          log.textContent = 'HTTP Error: ' + res.status + ' ' + res.statusText;
          throw new Error('HTTP Error: ' + res.status);
        }
        return res.text();
      })
      .then(text => {
        result.textContent = '‚úÖ Webhook sent! Response: ' + text;
        result.className = 'mt-4 text-center font-semibold text-success-600';
      })
      .catch(err => {
        log.style.display = 'block';
        log.textContent += '\n' + (err.message || err);
        result.textContent = '‚ùå Error sending webhook.';
        result.className = 'mt-4 text-center font-semibold text-danger-600';
      });
    }

    function testPBMatrixUrl() {
      const urlInput = document.getElementById('pb-url-test');
      const result = document.getElementById('pb-url-test-result');
      const dataDiv = document.getElementById('pb-url-test-data');
      const jsonPre = document.getElementById('pb-url-test-json');
      
      const url = urlInput.value.trim();
      
      if (!url) {
        result.textContent = 'Please enter a URL';
        result.className = 'mt-4 text-center font-semibold text-danger-600';
        return;
      }
      
      // Show loading state
      result.textContent = '‚è≥ Testing URL...';
      result.className = 'mt-4 text-center font-semibold text-primary-600';
      dataDiv.style.display = 'none';
      
      // Add format=json parameter
      const jsonUrl = url + (url.includes('?') ? '&' : '?') + 'format=json';
      
      fetch(jsonUrl)
        .then(response => {
          if (!response.ok) {
            throw new Error('HTTP Error: ' + response.status + ' ' + response.statusText);
          }
          return response.json();
        })
        .then(data => {
          result.textContent = '‚úÖ URL is working! Found ' + (data.rows ? data.rows.length : 0) + ' members and ' + (data.exercises ? data.exercises.length : 0) + ' exercises.';
          result.className = 'mt-4 text-center font-semibold text-success-600';
          dataDiv.style.display = 'block';
          jsonPre.textContent = JSON.stringify(data, null, 2);
        })
        .catch(error => {
          result.textContent = '‚ùå Error: ' + error.message;
          result.className = 'mt-4 text-center font-semibold text-danger-600';
          dataDiv.style.display = 'none';
        });
    }
  </script>
</body>
</html>
