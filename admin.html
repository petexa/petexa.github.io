<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Webhook Test | Iron & Ale</title>
  <meta name="description" content="Iron & Ale admin tools - Webhook testing and PB Matrix URL validation.">
  <link rel="stylesheet" href="assets/css/style.css">
  <link href="https://fonts.googleapis.com/css?family=Orbitron:700&display=swap" rel="stylesheet">
  <link rel="icon" type="image/svg+xml" href="https://api.iconify.design/mdi:dumbbell.svg?color=%2319baff" />
</head>
<body class="neon-bg">
  <div class="page-wrapper">
    <nav class="neon-nav" role="navigation" aria-label="Main navigation">
      <button class="menu-toggle" aria-label="Toggle navigation menu" aria-expanded="false">
        <span></span>
        <span></span>
        <span></span>
      </button>
      <ul id="nav-list">
        <li><a href="index.html" aria-label="Home page">HOME</a></li>
        <li><a href="events.html" aria-label="View upcoming events">EVENTS</a></li>
        <li><a href="projects.html" aria-label="View community projects">PROJECTS</a></li>
        <li><a href="utilities.html" aria-label="Member utilities">UTILITIES</a></li>
      </ul>
    </nav>
    <main role="main">
      <section class="hero-section" style="min-height:20vh;">
        <div class="hero-content">
          <h1 class="neon-title">Admin Webhook Test</h1>
          <p class="hero-headline">Send a test workout log to your webhook endpoint.</p>
        </div>
      </section>
      <div class="utility-card" style="max-width:500px;margin:32px auto;">
        <form id="webhook-test-form" style="display:flex;flex-direction:column;gap:16px;">
          <input type="text" id="test-name" placeholder="Name" required value="Test User" style="padding:12px;border-radius:6px;border:2px solid #19baff;background:#222;color:#fff;">
          <input type="text" id="test-exercise" placeholder="Exercise" required value="Bench Press" style="padding:12px;border-radius:6px;border:2px solid #19baff;background:#222;color:#fff;">
          <input type="date" id="test-date" required value="2025-11-26" style="padding:12px;border-radius:6px;border:2px solid #19baff;background:#222;color:#fff;">
          <input type="number" id="test-sets" placeholder="Sets" min="1" required value="3" style="padding:12px;border-radius:6px;border:2px solid #19baff;background:#222;color:#fff;">
          <input type="number" id="test-reps" placeholder="Reps" min="1" required value="10" style="padding:12px;border-radius:6px;border:2px solid #19baff;background:#222;color:#fff;">
          <input type="number" id="test-weight" placeholder="Weight" min="0" required value="60" style="padding:12px;border-radius:6px;border:2px solid #19baff;background:#222;color:#fff;">
          <textarea id="test-notes" placeholder="Notes" rows="2" style="padding:12px;border-radius:6px;border:2px solid #19baff;background:#222;color:#fff;">Sample test data for webhook</textarea>
          <button type="button" class="neon-btn neon-btn-blue" onclick="sendWebhookTest()">Send Test to Webhook</button>
        </form>
        <div id="webhook-test-result" style="margin-top:18px;text-align:center;color:#fff;font-family:'Orbitron',Arial,sans-serif;"></div>
        <div id="webhook-test-log" style="margin-top:18px;text-align:left;color:#ff5555;font-family:'Orbitron',Arial,sans-serif;background:#222;padding:12px;border-radius:8px;display:none;"></div>
      </div>

      <!-- PB Matrix URL Test Section -->
      <div class="utility-card" style="max-width:500px;margin:32px auto;">
        <h3 style="color:#19baff;font-family:'Orbitron',Arial,sans-serif;text-align:center;margin-bottom:16px;">üèÜ PB Matrix URL Test</h3>
        <p style="color:#888;text-align:center;margin-bottom:16px;font-size:0.9rem;">Test the Google Apps Script URL for the Personal Bests Matrix.</p>
        <div style="display:flex;flex-direction:column;gap:16px;">
          <input type="text" id="pb-url-test" placeholder="Enter PB Matrix URL" 
            value="https://script.google.com/macros/s/AKfycbzFslB8yDXO8G9ClvbFZX5q8URyvVSQa7R6mfnWpl2a7Cy4gxIRugOzkO4t4o7WlX_jOw/exec" 
            style="padding:12px;border-radius:6px;border:2px solid #ffb84d;background:#222;color:#fff;font-size:0.85rem;">
          <button type="button" class="neon-btn neon-btn-yellow" onclick="testPBMatrixUrl()">Test PB Matrix URL</button>
        </div>
        <div id="pb-url-test-result" style="margin-top:18px;text-align:center;color:#fff;font-family:'Orbitron',Arial,sans-serif;"></div>
        <div id="pb-url-test-data" style="margin-top:12px;background:#222;padding:12px;border-radius:8px;display:none;max-height:200px;overflow-y:auto;">
          <pre id="pb-url-test-json" style="color:#39ff14;font-size:0.8rem;white-space:pre-wrap;word-break:break-all;margin:0;"></pre>
        </div>
      </div>
    </main>
    <!-- Footer -->
    <footer class="site-footer" role="contentinfo">
      <div class="footer-content">
        <nav class="footer-social" aria-label="Social media links">
          <a href="https://instagram.com" target="_blank" rel="noopener noreferrer" aria-label="Follow us on Instagram">
            <img src="https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/instagram.svg" alt="Instagram" style="width:28px;height:28px;vertical-align:middle;filter:drop-shadow(0 0 4px #e1306c);" />
          </a>
          <a href="https://facebook.com" target="_blank" rel="noopener noreferrer" aria-label="Follow us on Facebook">
            <img src="https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/facebook.svg" alt="Facebook" style="width:28px;height:28px;vertical-align:middle;filter:drop-shadow(0 0 4px #1877f3);" />
          </a>
          <a href="https://twitter.com" target="_blank" rel="noopener noreferrer" aria-label="Follow us on Twitter">
            <img src="https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/twitter.svg" alt="Twitter" style="width:28px;height:28px;vertical-align:middle;filter:drop-shadow(0 0 4px #1da1f2);" />
          </a>
        </nav>
        <p class="footer-copyright">
          &copy; <span id="current-year">2024</span> Iron & Ale. All rights reserved.
        </p>
      </div>
    </footer>
  </div>
  <script>
    // Set current year in footer
    document.getElementById('current-year').textContent = new Date().getFullYear();

    function sendWebhookTest() {
      const result = document.getElementById('webhook-test-result');
      const log = document.getElementById('webhook-test-log');
      result.textContent = '';
      log.style.display = 'none';
      log.textContent = '';
      const data = {
        name: document.getElementById('test-name').value,
        exercise: document.getElementById('test-exercise').value,
        date: document.getElementById('test-date').value,
        sets: document.getElementById('test-sets').value,
        reps: document.getElementById('test-reps').value,
        weight: document.getElementById('test-weight').value,
        notes: document.getElementById('test-notes').value
      };
      fetch('https://n8n.petefox.co.uk/webhook/workout-log', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      })
      .then(res => {
        if (!res.ok) {
          log.style.display = 'block';
          log.textContent = 'HTTP Error: ' + res.status + ' ' + res.statusText;
          throw new Error('HTTP Error: ' + res.status);
        }
        return res.text();
      })
      .then(text => {
        result.textContent = 'Webhook sent! Response: ' + text;
        result.style.color = '#39ff14';
      })
      .catch(err => {
        log.style.display = 'block';
        log.textContent += '\n' + (err.message || err);
        result.textContent = 'Error sending webhook.';
        result.style.color = '#ff5555';
      });
    }

    function testPBMatrixUrl() {
      const urlInput = document.getElementById('pb-url-test');
      const result = document.getElementById('pb-url-test-result');
      const dataDiv = document.getElementById('pb-url-test-data');
      const jsonPre = document.getElementById('pb-url-test-json');
      
      const url = urlInput.value.trim();
      
      if (!url) {
        result.textContent = 'Please enter a URL';
        result.style.color = '#ff5555';
        return;
      }
      
      // Show loading state
      result.textContent = '‚è≥ Testing URL...';
      result.style.color = '#19baff';
      dataDiv.style.display = 'none';
      
      // Add format=json parameter
      const jsonUrl = url + (url.includes('?') ? '&' : '?') + 'format=json';
      
      fetch(jsonUrl)
        .then(response => {
          if (!response.ok) {
            throw new Error('HTTP Error: ' + response.status + ' ' + response.statusText);
          }
          return response.json();
        })
        .then(data => {
          result.textContent = '‚úÖ URL is working! Found ' + (data.rows ? data.rows.length : 0) + ' members and ' + (data.exercises ? data.exercises.length : 0) + ' exercises.';
          result.style.color = '#39ff14';
          dataDiv.style.display = 'block';
          jsonPre.textContent = JSON.stringify(data, null, 2);
        })
        .catch(error => {
          result.textContent = '‚ùå Error: ' + error.message;
          result.style.color = '#ff5555';
          dataDiv.style.display = 'none';
        });
    }
  </script>
  <script src="assets/js/main.js"></script>
</body>
</html>
