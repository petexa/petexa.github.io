<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Past Events - IDFit Events</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
<style>
    body {
        font-family: Arial, sans-serif;
        background: #000080;
        margin: 0;
        padding: 0;
        min-height: 100vh;
    }
    header {
        text-align: center;
        padding: 40px 10px 15px 10px;
        border-radius: 8px;
        background: #001284;
    }
    .logo {
        width: 85px;
        height: 85px;
        border-radius: 50%;
        margin-bottom: 12px;
        object-fit: cover;
        background: #fff;
        box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    }
    h1 {
        font-size: 2.1rem;
        font-weight: 700;
        color: #fff;
        letter-spacing: 1px;
        border-bottom: 2.5px solid #fff;
        display: inline-block;
        padding-bottom: 6px;
        margin: 0 auto 6px auto;
    }
    .subtitle {
        font-size: 1rem;
        color: #e4ecfc;
        margin-bottom: 0;
        letter-spacing: 0.4px;
        font-weight: 400;
        display: block;
    }
    .back-link {
        margin-top: 15px;
    }
    .back-link a {
        color: #80affe;
        text-decoration: none;
        font-size: 1rem;
        transition: color 0.18s;
    }
    .back-link a:hover,
    .back-link a:focus {
        color: #29ffb4;
        text-decoration: underline;
    }
    .empty-events {
        color: #fff;
        background: #233fc2;
        text-align: center;
        font-size: 1.2rem;
        font-weight: 600;
        border-radius: 14px;
        margin: 42px auto;
        padding: 25px 18px;
        max-width: 430px;
        box-shadow: 0 2px 16px rgba(0,0,0,0.14);
        outline: 2.5px dashed #23bb57;
    }
    main {
        display: flex;
        flex-wrap: wrap;
        gap: 24px;
        justify-content: center;
        padding: 30px 10px 35px 10px;
        max-width: 1100px;
        margin: 0 auto;
    }
    .event-card {
        background: #fff;
        border-radius: 18px;
        box-shadow: 0 2px 16px rgba(0,0,0,0.12);
        width: 355px;
        min-width: 0;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        transition: border 0.2s, box-shadow 0.2s;
        border: 2px solid transparent;
        opacity: 0.85;
    }
    .event-img {
        width: 100%;
        height: 120px;
        object-fit: cover;
        background: #e4ecfc;
        background-size: cover;
        background-repeat: no-repeat;
    }
    .event-img.placeholder {
        background: #c8c8ff;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #555;
        font-size: 1.3rem;
        font-style: italic;
    }
    .event-content {
        padding: 20px 18px 17px 18px;
        flex: 1 1 auto;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }
    .event-title {
        font-size: 18px;
        font-weight: 700;
        color: #fff !important;
        margin-bottom: 5px;
        background: #000080;
        padding: 8px 12px;
        border-radius: 8px;
        margin: -20px -18px 8px -18px;
    }
    .event-date {
        color: #fff;
        font-size: 15px;
        font-weight: 600;
        margin-bottom: 8px;
    }
    .event-desc {
        font-size: 14px;
        color: #092266;
        margin-bottom: 12px;
        min-height: 38px;
    }
    .event-status {
        color: #023;
        background: #f0f4ff;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        padding: 6px 0 4px 0;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        margin-bottom: 12px;
        min-height: 34px;
        letter-spacing: 0.5px;
    }
    .event-status i {
        color: #666;
        margin-right: 5px;
    }
    .button {
        flex: 1 1 auto;
        display: inline-block;
        text-align: center;
        padding: 11px 0;
        color: #fff;
        text-decoration: none;
        border-radius: 11px;
        font-size: 1rem;
        font-weight: 700;
        background: #087ec0;
        border: none;
        transition: background 0.19s, color 0.19s, box-shadow 0.17s;
        box-shadow: 0 1px 7px rgba(0,0,0,0.09);
        outline: none;
    }
    .button:hover,
    .button:focus {
        background: #055f90;
        color: #fff;
    }
    @media (max-width: 850px) {
      main {
        flex-direction: column;
        align-items: center;
        gap: 18px;
      }
      .event-card {width: 97vw; max-width: 370px;}
    }
    footer {
      text-align: center;
      color: #bed;
      font-size: 15px;
      padding: 32px 6px 24px 6px;
      background: #001040;
      margin-top: 25px;
    }
    .footer-links {
      margin-top: 9px;
      font-size: 1.2rem;
    }
    .footer-links a {
      color: #80affe;
      margin: 0 10px;
      text-decoration: none;
      transition: color 0.18s;
    }
    .footer-links a:hover,
    .footer-links a:focus {color: #29ffb4;}
    
    /* Floating Action Button */
    .fab {
        position: fixed;
        bottom: 25px;
        right: 25px;
        width: 60px;
        height: 60px;
        background: #23bb57;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        cursor: pointer;
        border: none;
        z-index: 999;
        transition: transform 0.2s, background 0.2s;
    }
    .fab:hover {
        background: #1d9947;
        transform: scale(1.1);
    }
    .fab i {
        color: #fff;
        font-size: 24px;
    }
    
    /* Modal Dialog */
    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.75);
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
    }
    .modal-content {
        background: #fff;
        margin: 20px auto;
        padding: 0;
        border-radius: 16px;
        max-width: 600px;
        width: calc(100% - 40px);
        box-shadow: 0 4px 24px rgba(0,0,0,0.4);
        position: relative;
        max-height: calc(100vh - 40px);
        display: flex;
        flex-direction: column;
    }
    .modal-header {
        background: #000080;
        color: #fff;
        padding: 20px 24px;
        border-radius: 16px 16px 0 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .modal-header h2 {
        margin: 0;
        font-size: 1.5rem;
        font-weight: 700;
    }
    .close-btn {
        background: none;
        border: none;
        color: #fff;
        font-size: 28px;
        cursor: pointer;
        padding: 0;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: background 0.2s;
    }
    .close-btn:hover {
        background: rgba(255,255,255,0.2);
    }
    .modal-body {
        padding: 24px;
        overflow-y: auto;
        flex: 1;
    }
    .form-group {
        margin-bottom: 20px;
    }
    .form-group label {
        display: block;
        margin-bottom: 6px;
        font-weight: 600;
        color: #000080;
        font-size: 14px;
    }
    .form-group input,
    .form-group textarea,
    .form-group select {
        width: 100%;
        padding: 12px;
        border: 2px solid #c8c8ff;
        border-radius: 8px;
        font-size: 16px;
        font-family: Arial, sans-serif;
        box-sizing: border-box;
        transition: border-color 0.2s;
    }
    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
        outline: none;
        border-color: #000080;
    }
    .form-group textarea {
        resize: vertical;
        min-height: 80px;
    }
    .form-group small {
        display: block;
        margin-top: 4px;
        color: #666;
        font-size: 12px;
    }
    .checkbox-group {
        display: flex;
        align-items: center;
        gap: 8px;
    }
    .checkbox-group input[type="checkbox"] {
        width: auto;
        margin: 0;
    }
    .checkbox-group label {
        margin: 0;
        font-weight: normal;
    }
    .modal-footer {
        padding: 16px 24px;
        border-top: 1px solid #e0e0e0;
        display: flex;
        gap: 12px;
        justify-content: flex-end;
    }
    .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s;
    }
    .btn-primary {
        background: #23bb57;
        color: #fff;
    }
    .btn-primary:hover {
        background: #1d9947;
    }
    .btn-secondary {
        background: #e0e0e0;
        color: #333;
    }
    .btn-secondary:hover {
        background: #d0d0d0;
    }
    
    @media (max-width: 600px) {
        .fab {
            bottom: 20px;
            right: 20px;
            width: 56px;
            height: 56px;
        }
        .fab i {
            font-size: 22px;
        }
        .modal-content {
            margin: 10px auto;
            width: calc(100% - 20px);
        }
        .modal-header {
            padding: 16px 20px;
        }
        .modal-header h2 {
            font-size: 1.3rem;
        }
        .modal-body {
            padding: 20px;
        }
        .modal-footer {
            padding: 12px 20px;
            flex-direction: column;
        }
        .btn {
            width: 100%;
        }
    }
</style>
</head>
<body>
<header>
    <h1>Past Events</h1>
    <div class="subtitle">Browse through events that have already taken place</div>
    <div class="back-link">
        <a href="index.html"><i class="fa-solid fa-arrow-left"></i> Back to Upcoming Events</a>
    </div>
</header>
<main id="events-list" aria-live="polite">
</main>
<footer>
  <div>
    &copy; <span id="footerYear"></span> Have an event? <a href="images/callme.gif" style="color:#fff;text-decoration:underline;" target="_blank" rel="noopener noreferrer">Contact us</a>
  </div>
  <div class="footer-links">
    <a href="https://facebook.com" target="_blank" title="Facebook" aria-label="Facebook (opens in new tab)"><i class="fab fa-facebook"></i></a>
    <a href="https://instagram.com" target="_blank" title="Instagram" aria-label="Instagram (opens in new tab)"><i class="fab fa-instagram"></i></a>
    <a href="https://twitter.com" target="_blank" title="X (Twitter)" aria-label="Twitter/X (opens in new tab)"><i class="fab fa-x-twitter"></i></a>
  </div>
</footer>

<!-- Floating Action Button -->
<button class="fab" onclick="openModal()" aria-label="Create new event">
    <i class="fa-solid fa-plus"></i>
</button>

<!-- Modal Dialog -->
<div id="eventModal" class="modal" role="dialog" aria-labelledby="modalTitle" aria-hidden="true">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="modalTitle">Create New Event</h2>
            <button class="close-btn" onclick="closeModal()" aria-label="Close dialog">
                <i class="fa-solid fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <form id="eventForm">
                <div class="form-group">
                    <label for="eventName">Event Name *</label>
                    <input type="text" id="eventName" name="eventName" required placeholder="e.g., Nuclear Fit Spring 2026">
                </div>
                
                <div class="form-group">
                    <label for="eventDate">Event Date & Time *</label>
                    <input type="datetime-local" id="eventDate" name="eventDate" required>
                    <small>Select the date and time of the event</small>
                </div>
                
                <div class="form-group">
                    <label for="eventLink">Event Link (URL) *</label>
                    <input type="url" id="eventLink" name="eventLink" required placeholder="https://example.com/event">
                    <small>Link to event registration or information page</small>
                </div>
                
                <div class="form-group">
                    <label for="eventImage">Image URL *</label>
                    <input type="url" id="eventImage" name="eventImage" required placeholder="https://example.com/image.jpg">
                    <small>URL to the event image</small>
                </div>
                
                <div class="form-group">
                    <label for="eventDescription">Description *</label>
                    <textarea id="eventDescription" name="eventDescription" required placeholder="Brief description of the event"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="eventLocation">Location</label>
                    <input type="text" id="eventLocation" name="eventLocation" placeholder="e.g., Kelvedon Hatch, UK">
                </div>
                
                <div class="form-group">
                    <label for="eventDuration">Duration (hours)</label>
                    <input type="number" id="eventDuration" name="eventDuration" min="1" max="24" value="4" placeholder="4">
                </div>
                
                <div class="form-group">
                    <label for="calendarDescription">Calendar Description</label>
                    <textarea id="calendarDescription" name="calendarDescription" placeholder="Detailed description for calendar"></textarea>
                    <small>Optional - appears when users add event to their calendar</small>
                </div>
                
                <div class="form-group">
                    <label style="margin-bottom: 12px;">Display Options</label>
                    <div class="checkbox-group">
                        <input type="checkbox" id="showMoreInfo" name="showMoreInfo" checked>
                        <label for="showMoreInfo">Show "More Info" button</label>
                    </div>
                    <div class="checkbox-group" style="margin-top: 8px;">
                        <input type="checkbox" id="showBookNow" name="showBookNow">
                        <label for="showBookNow">Show "Book Now" button</label>
                    </div>
                    <div class="checkbox-group" style="margin-top: 8px;">
                        <input type="checkbox" id="showRemindMe" name="showRemindMe" checked>
                        <label for="showRemindMe">Show "Remind Me" button</label>
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
            <button type="button" class="btn btn-primary" onclick="generateEvent()">Generate Event JSON</button>
        </div>
    </div>
</div>

<script>
// Event data will be loaded from separate JSON files
let events = [];
let pastEvents = [];

// Load events from JSON files
async function loadEvents() {
    try {
        // First, load the list of event files
        const response = await fetch('events/events-list.json');
        const eventFiles = await response.json();
        
        // Load all event files
        const eventPromises = eventFiles.map(file => 
            fetch(file).then(res => res.json())
        );
        
        events = await Promise.all(eventPromises);
        
        // Filter for past events and sort by date (most recent first)
        const now = new Date();
        pastEvents = events
            .filter(ev => new Date(ev.date) < now)
            .sort((a,b) => new Date(b.date) - new Date(a.date));
        
        // Render the events
        renderEvents();
    } catch (error) {
        console.error('Error loading events:', error);
        document.getElementById("events-list").innerHTML = `<div class="empty-events" role="alert">Unable to load events. Please try again later.</div>`;
    }
}

// Utility: Ordinal suffix
function getOrdinal(n) {
    let s = ["th","st","nd","rd"],
        v = n%100;
    return n + (s[(v-20)%10] || s[v] || s[0]);
}
// Utility: Format date e.g. 22nd Nov 2025, 12:00
function formatEventDate(dateString) {
    const d = new Date(dateString);
    const day = getOrdinal(d.getDate());
    const monthNames = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
    const month = monthNames[d.getMonth()];
    const year = d.getFullYear();
    let pieces = [`${day} ${month} ${year}`];
    if (d.getHours() + d.getMinutes() > 0) {
        let mins = String(d.getMinutes()).padStart(2, "0");
        pieces.push(`${d.getHours()}:${mins}`);
    }
    return pieces.join(", ");
}

// Render past event cards
function renderEvents() {
    let eventListHtml = "";
    
    if (pastEvents.length === 0) {
        eventListHtml = `<div class="empty-events" role="alert">No past events found. Check back after some events have taken place!</div>`;
    } else {
        eventListHtml = pastEvents.map((ev, i) => {
            // Event image with error fallback
            const imgId = `event-img-${i}`;
            let imgHtml = `<img src="${ev.image}" class="event-img" id="${imgId}" alt="Preview for ${ev.name}" loading="lazy" onerror="onImgError('${imgId}')">`;

            return `<section class="event-card">
                ${imgHtml}
                <div class="event-content">
                  <header>
                    <div class="event-title">${ev.name}</div>
                    <time class="event-date" datetime="${ev.date}">${formatEventDate(ev.date)}</time>
                  </header>
                  <div class="event-desc">${ev.description}</div>
                  <div class="event-status">
                      <i class="fa-solid fa-check-circle"></i>
                      <span>Event Completed</span>
                  </div>
                  <a class="button" href="${ev.link}" target="_blank" rel="noopener noreferrer" aria-label="More information about ${ev.name} (opens in new tab)">More Info</a>
                </div>
              </section>`;
        }).join("");
    }

    document.getElementById("events-list").innerHTML = eventListHtml;
}

// Event image fallback
window.onImgError = function(id) {
    var img = document.getElementById(id);
    if (img) {
        img.onerror = null;
        img.classList.add("placeholder");
        img.src = "";
        img.alt = "Image unavailable";
        img.style.background = "#b8b8f0";
        img.style.display = "flex";
        img.style.justifyContent = "center";
        img.style.alignItems = "center";
        img.outerHTML = `<div class="event-img placeholder" title="Preview image unavailable">Image unavailable</div>`;
    }
};

// Update footer year dynamically
document.getElementById("footerYear").textContent = new Date().getFullYear();

// Load events from JSON files on page load
loadEvents();

// Modal functions
function openModal() {
    const modal = document.getElementById('eventModal');
    modal.style.display = 'block';
    modal.setAttribute('aria-hidden', 'false');
    // Set default date to today
    const now = new Date();
    const offset = now.getTimezoneOffset() * 60000;
    const localISOTime = new Date(now - offset).toISOString().slice(0, 16);
    document.getElementById('eventDate').value = localISOTime;
}

function closeModal() {
    const modal = document.getElementById('eventModal');
    modal.style.display = 'none';
    modal.setAttribute('aria-hidden', 'true');
    document.getElementById('eventForm').reset();
}

// Close modal when clicking outside
window.onclick = function(event) {
    const modal = document.getElementById('eventModal');
    if (event.target === modal) {
        closeModal();
    }
}

// Close modal on ESC key
document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modal = document.getElementById('eventModal');
        if (modal.style.display === 'block') {
            closeModal();
        }
    }
});

function generateEvent() {
    const form = document.getElementById('eventForm');
    
    // Validate form
    if (!form.checkValidity()) {
        form.reportValidity();
        return;
    }
    
    // Get form values
    const eventName = document.getElementById('eventName').value.trim();
    const eventDate = document.getElementById('eventDate').value;
    const eventLink = document.getElementById('eventLink').value.trim();
    const eventImage = document.getElementById('eventImage').value.trim();
    const eventDescription = document.getElementById('eventDescription').value.trim();
    const eventLocation = document.getElementById('eventLocation').value.trim();
    const eventDuration = parseInt(document.getElementById('eventDuration').value) || 4;
    const calendarDescription = document.getElementById('calendarDescription').value.trim();
    const showMoreInfo = document.getElementById('showMoreInfo').checked;
    const showBookNow = document.getElementById('showBookNow').checked;
    const showRemindMe = document.getElementById('showRemindMe').checked;
    
    // Format date to ISO 8601
    const formattedDate = new Date(eventDate).toISOString().slice(0, 19);
    
    // Create event object
    const eventData = {
        name: eventName,
        date: formattedDate,
        link: eventLink,
        image: eventImage,
        description: eventDescription,
        calendarDetails: {
            location: eventLocation || "",
            description: calendarDescription || eventDescription,
            durationHours: eventDuration
        },
        showMoreInfo: showMoreInfo,
        showBookNow: showBookNow,
        showRemindMe: showRemindMe
    };
    
    // Convert to JSON with pretty formatting
    const jsonString = JSON.stringify(eventData, null, 2);
    
    // Create filename from event name and date
    const dateStr = eventDate.split('T')[0].replace(/-/g, '');
    const nameSlug = eventName.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)/g, '');
    const filename = `${nameSlug}-${dateStr}.json`;
    
    // Create blob and download
    const blob = new Blob([jsonString], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    a.click();
    URL.revokeObjectURL(url);
    
    // Show success message
    alert(`Event JSON file "${filename}" has been downloaded!\n\nNext steps:\n1. Upload the file to the events/ directory\n2. Add the file path to events/events-list.json\n3. Upload any event images to the images/ directory`);
    
    // Close modal
    closeModal();
}

</script>
</body>
</html>
